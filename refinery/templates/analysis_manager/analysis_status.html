{% extends "base.html" %}

{% block subheader %}
<div class="page-header">
	{% if REFINERY_REPOSITORY_MODE %}
	<h1>Download&nbsp;<small>{{ analysis.name }}</small></h1>
	{% else %}
	<h1>Analysis&nbsp;<small>{{ analysis.name }}</small></h1>
	{% endif %}
</div>
{% endblock %}

{% block content %}
<div class="refinery-panel refinery-panel-content scrollable">
	<div class="row-fluid">		
	
	{% if statuses %}
	
		<div class="row-fluid">
			<div class="span12">
				<h3>
					Status
				</h3>
				{% if REFINERY_REPOSITORY_MODE %}
				<p>
					<i class="icon-time"></i>&nbsp;Preparing archive ({{analysis.name}}) for download.
				</p>
				{% else %}
				<p>
					<i class="icon-cog"></i>&nbsp;<a href="{% url 'workflow' statuses.analysis.workflow.uuid %}">{{ statuses.analysis.workflow.name }}</a> started on {{ statuses.analysis.modification_date }}.
										
					<!-- <i class="icon-file"></i>&nbsp;<a href="{% url 'data_set' statuses.analysis.data_set.uuid %}">{{ statuses.analysis.data_set.name }}</a> -->
				</p>
				
				<p>
					<button type="button" class="btn" id="cancel-analysis-button">View in Galaxy</button>
					<button type="button" class="btn btn-danger" id="cancel-analysis-button">Cancel Analysis</button>
				</p>
				{% endif %}
			</div> <!-- column -->
		</div> <!-- row -->
		
		<div class="row-fluid">
			<div class="span4">

	        	<h4>Preprocessing</h4>
	        	
	        	<div id="preprocessing-status" class="">						        		
	        	</div>
			            
 			</div> <!-- column -->
 			<div class="span4">
 
              <h4>Execution</h4>

	        	<div id="execution-status" class="">						        		
	        	</div>
            
			 </div> <!-- column -->
			 <div class="span4">
			            
              <h4>Postprocessing</h4>

	        	<div id="postprocessing-status" class="">						        		
	        	</div>
            
			</div> <!-- column --> 
		</div> <!-- row -->
                  
	{% endif %}
</div>
</div>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/refinery/analysis_manager/analysis_monitor.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/bootbox/bootbox.min.js"></script>
	
	<script>
	$(document).ready(function() {		
		monitor = new AnalysisMonitor("{{ uuid }}", document.location.protocol + "//" + document.location.host, "{% url 'analysis' statuses.analysis.uuid %}", "{{ csrf_token }}");
		monitor.getUpdate();
		
		var timerId = setInterval( function(){ monitor.getUpdate(); }, 3000 );

					//<a href="{{ statuses.analysis.workflow.workflow_engine.instance.base_url }}/history/list?f-sharing=All&sort=-update_time&f-name=All&f-tags=All&f-deleted=False&operation=Switch&use_panels=False&id={{ statuses.analysis.history_id }}">View in Galaxy</a>) 
		
		$("#cancel-analysis-button").click( function(event) {
				bootbox.confirm(
	   				"<h3><i class=\"icon-question\"></i>&nbsp;&nbsp;Cancel Analysis?</h3>" +
					"<p>" +
					"Are you sure you want to cancel this analysis?" +
					"</p>",
					function(result) {
						if ( result ) {
							alert( "User canceled analysis!" );							
						}
					}
				); 				
			});		
	});    		
	</script>
{% endblock %}

