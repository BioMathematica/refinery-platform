{% extends "base.html" %}
{% load humanize %}

{% block head_html %}

    <style type="text/css">

svg {
	background-color: none;
	padding: 5px;
	margin-top: 15px;
	margin-bottom: 15px;
}    
.background {
  fill: #777;
}

line {
  stroke: #eee;
}

text.active {
  fill: red;
}

rect.frame {
  stroke: #f0f0f0;
}

rect.active {
  fill: red;
}

	.pivot-matrix {
		background-color: #f00;
	}

    
 	.facet-title {
 		cursor:pointer; 		
 	} 	

 	.facet-value {
 		cursor:pointer; 		
 	}

 	tr th {
 		cursor:pointer;
 	}
 	 
 	.field-name {
 		cursor:pointer;
 	} 
 	 	
 	#facet-view .active {
 		cursor:pointer; 
 		background-color: #3A87AD;
 		color: #fff;
 		font-weight: bold;
 	} 	
 	
 	#pager-view {
 		text-align:right;
 	}

 	#statistics-view {
 		text-align:right;
 	}
 	#url-view {
 		text-align:right;
 	}

 	.facet-value-list td {
 		padding: 2px; 		
 	}
 	.facet-value-list tr {
 		padding: 2px; 		
 	}
 	
 	.facet-value-list.selected {
 	}
 	
 	.facet-title {
 		margin-top: 10px;
 	}
    </style>
{% endblock %}


{% block title %}
{{ block.super }} - Data Set {{ data_set.name }}
{% endblock %}

{% block subheader %}
 <div class="page-header">
  	<h1>Data Set <small>{{ data_set.name }}</small></h1>
</div>

{% endblock %}

{% block content %}
	<!-- tab headers -->
	
<div class="refinery-panel-tabs">

	<div class="row-fluid">      
	    <ul class="nav nav-tabs" id="tabs">
  			<li class="active"><a href="#content" data-toggle="tab">Samples</a></li>
  			<li><a href="#analyses" data-toggle="tab">Analyses</a></li>
  			<li><a href="#about" data-toggle="tab">About</a></li>
  			<li><a href="#sharing" data-toggle="tab">Sharing</a></li>
  	    </ul>
  	</div>
  	
</div>
<div class="refinery-panel refinery-panel-content scrollable">

	{% if data_set %}	
	<!-- tabs -->

	<div class="tab-content">

  		<div class="tab-pane fade active in" id="content">			
			<form id="sampleForm" method="post" class="form-inline">
				{% csrf_token %}
			
				<!-- pass study information into the receiving view when posting -->
				<input type="hidden" name="study_uuid" value="{{ study_uuid }}"/>
			 
			<div class="row-fluid">
			 	<div class="span10">
			 								
							{% if REFINERY_REPOSITORY_MODE %}
							<!-- CHECK BOXES FOR SELECTING SAMPLES --> 
							<span class="label">Selection</span>
							{% for work in workflows %}
								<a id="submitSamplesBtn" data-workflow_id="{{work.uuid}}" role="button" class="btn" >Download Archive</a>
							{% endfor %}
							
							{% else %}
							<!-- DROP DOWN BUTTONS FOR MULTIPLE WORKFLOWS --> 
							<select class="combobox" name="workflow_choice" id="workflow_choice">
								<option></option>
								{% for work in workflows %}
									<option value="{{work.uuid}}">{{work.name}}</option>
								{% endfor %}
							</select>
							<a class="btn" id="submitSamplesBtn">Apply</a> &nbsp;	
							
							{% endif %}
							
							<!-- <span class="label" style="margin-left: 50px;">View in</span> -->
							<a id="igv-multi-species" href="#" role="button" class="btn" data-toggle="modal">Launch IGV</a>
							
							<!-- <a class="btn" id="profile-viewer-session-link" href="#">Profile</a> -->

							
							<span class="label" style="margin-left: 50px;">Show</span>
							<div class="btn-group annotation-buttons" data-toggle="buttons-radio">
							  	<button type="button" id="data-button" data-toggle="button" class="btn active">Data</button>
							  	<button type="button" id="annotation-button" data-toggle="button" class="btn">Annotation</button>
							</div>				
						</div>
			
			 	<div class="span2">
					<div id="statistics-view"></div> 		
			 	</div>	
			</div>
			
			<div class="row-fluid">
			 	
			 	<div class="span2">
						<ul class="nav nav-pills" id="navigation-tabs">
						  <li class="active"><a href="#facet-view" data-toggle="pill">Facets</a></li>
						</ul> 		
						<div id="facet-view" class="accordion"></div>
			 	</div>	
			 	
			 	<div class="span10"> 			
					
					<div class="tabbable">
						<ul class="nav nav-pills" id="navigation-tabs">
						  <li class="active"><a href="#table-view-tab" data-toggle="pill">List</a></li>
						  <li><a href="#pivot-view-tab" data-toggle="pill">Matrix</a></li>
						</ul>
			
						<div class="tab-content">
						  <div class="tab-pane active fade in" id="table-view-tab">
							<div id="table-view"></div>
							<div id="pager-view"></div>
							<div id="field-view"></div>  	
						  </div>
						  <div class="tab-pane fade in" id="pivot-view-tab">
						  	<div id="pivot-view">			  		
						  	</div>			  	
						  	<div id="pivot-matrix">
						  		<!-- the matrix -->
						  	</div>
						  </div>
						</div>
					</div>			
					
				</div>
				
			</div>
			
			<div class="row-fluid">
			 	<div class="span12">
				 	<div id="url-view"></div>
			 	</div>		 
			</div>
		</form>
	</div>


  	<div class="tab-pane" id="analyses">
		<div class="refinery-header">
			<span class="refinery-header-left">
				<h3>Analyses</h3>
			</span>
		</div>
		<p>
		{% if data_set.analysis_set.all|length > 0 %}	
			{% for analysis in data_set.analysis_set.all %}
					<a href="{% url analysis_status analysis.uuid %}">{{ analysis.name }}</a>
					{% if analysis.project.is_catch_all %}
						(unassigned)
					{% else %}
						(Project <a href="{% url project analysis.project.uuid %}">{{ analysis.project.name }}</a>)
					{% endif %}  
					<br/>
			{% endfor %}
		{% else %}
			<i>None.</i>
		{% endif %}
		</p>		
  	</div>

	<div class="tab-pane" id="about">
			
			<div class="refinery-header">
				<span class="refinery-header-left">
					<h3>Summary</h3>				
				</span>
			</div>
			<p>{% if data_set.summary %} {{ data_set.summary }} {% else %} <i>None provided.</i>{% endif %}</p>
			
			<div class="refinery-header">
				<span class="refinery-header-left">
					<h3>Studies</h3>
				</span>
			</div>
			{% for study in studies %}
			<p><strong>{{study.identifier}}</strong>: {{study.title}}</p>
			<ul>
			{% for assay in study.assay_set.all %}
				<!-- <li>Assay - <a href="{% url data_set_manager_contents study.uuid assay.uuid %}">{{assay}}</a></li> -->
				<li>Assay - {{assay}}</li> 
			{% endfor %}
			</ul>
			{% endfor %}
		
			<div class="refinery-header">
				<span class="refinery-header-left">
					<h3>Files</h3>
				</span>
			</div>

			<span class="refinery-subheader">
				<h3>Meta Data</h3>
			</span>
			{% if isatab_archive or pre_isatab_archive %}
				<p>{{ isatab_archive.get_url }} files using {{ data_set.file_size|filesizeformat }}</p>
			{% else %}
				<p><i>Not available.</i></p>
			{% endif %}

			<span class="refinery-subheader">
				<h3>Data Files</h3>
			</span>
			<p>{{ data_set.file_count }} files using {{ data_set.file_size|filesizeformat }}</p>
								
			<div class="refinery-header">
				<span class="refinery-header-left">
					<h3>History</h3>
				</span>
			</div>
			<p>Current version <i>{{ data_set.get_version_details.version }}</i> created <i>{{ data_set.get_version_details.date }}</i>.
			Data set created <i>{{ data_set.creation_date }}</i>. Last modified <i>{{ data_set.modification_date }}</i>.</p>
		</div>


	  	<div class="tab-pane" id="sharing">
			<div class="refinery-header">
				<span class="refinery-header-left">	
					<h3>Sharing</h3>
				</span>
			</div>
			<div class="refinery-subheader">
				<h4>Owner</h4>
			</div>
			<p><a href="{% url user data_set.get_owner.get_profile.uuid %}">{% if data_set.get_owner.get_full_name %}{{ data_set.get_owner.get_full_name }}{% else %}{{ data_set.get_owner }}{%endif%}</a></p>
		
			{% if data_set.get_groups|length > 0 %}
			<h4>Groups</h4>
				<p>
				{% for perm in data_set.get_groups %}
						<a href="{% url group perm.group.uuid %}">{{ perm.group.name }}</a>&nbsp;
						{% if perm.read %}
							<i class="icon-eye-open"></i>
						{% endif %}
						{% if perm.change %}
							<i class="icon-pencil"></i>
						{% endif %}
				{% endfor %}
				</p>
			{% endif %}
	  		
	  	</div>

	</div>
	
	
		
	{% else %}
	    <p>No valid data set.</p>
	{% endif %}
	</div>
	
<!-- Modal -->
<div id="igvModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">Launch IGV</h3>
  </div>
  <div class="modal-body" id="myModalBody">      
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>


</div>

{% endblock %}

{% block script %}
	<!-- adding spinner -->
	<script language="javascript" type="text/javascript" src="http://fgnass.github.com/spin.js/dist/spin.min.js"></script>

	<script language="javascript" type="text/javascript">
	    var opts = {
	    lines: 13, // The number of lines to draw
	    length: 4, // The length of each line
	    width: 2, // The line thickness
	    radius: 6, // The radius of the inner circle
	    corners: 1, // Corner roundness (0..1)
	    rotate: 0, // The rotation offset
	    color: '#000', // #rgb or #rrggbb
	    speed: 1, // Rounds per second
	    trail: 60, // Afterglow percentage
	    shadow: false, // Whether to render a shadow
	    hwaccel: false, // Whether to use hardware acceleration
	    className: 'spinner', // The CSS class to assign to the spinner
	    zIndex: 2e9, // The z-index (defaults to 2000000000)
	    top: 'top', // Top position relative to parent in px
	    left: 'top' // Left position relative to parent in px
	    };
	</script>
	    
    <script type="text/javascript" src="{{ STATIC_URL }}js/d3/d3.v2.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/d3/fisheye.js"></script>

	<!-- Refinery libraries -->
	<script type="text/javascript">
		var REFINERY_BASE_URL = "{{ REFINERY_BASE_URL }}";
		var REFINERY_SOLR_BASE_URL = "{{ REFINERY_SOLR_BASE_URL }}";
		var externalStudyUuid = "{{ assay_uuid }}";
		var externalAssayUuid = "{{ study_uuid }}";
		var REFINERY_REPOSITORY_MODE = "{{ REFINERY_REPOSITORY_MODE }}"
	</script>	
    <script type="text/javascript" src="{{ STATIC_URL }}js/refinery/viewers/pivot-matrix.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}js/refinery/contents_workflow.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/refinery/contents.js"></script>
    <!-- <script type="text/javascript" src="{{ STATIC_URL }}js/bootbox/bootbox.min.js"></script> -->


<script type="application/javascript">
	$(document).ready(function () {
    	$("[rel=tooltip]").tooltip();
  	});
</script>
			    			        
{% endblock %}  
