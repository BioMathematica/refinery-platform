/*! refinery-platform-ui 2015-06-16 */

function calculate_md5(a,b){"use strict";function c(b){h.append(b.target.result),g++,f>g?d():md5[a.name]=h.end()}function d(){var d=new FileReader;d.onload=c;var f=g*b,h=Math.min(f+b,a.size);d.readAsArrayBuffer(e.call(a,f,h))}var e=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,f=Math.ceil(a.size/b),g=0,h=new SparkMD5.ArrayBuffer;d()}angular.module("refineryDataFileUpload",["blueimp.fileupload"]).config(["$httpProvider","fileUploadProvider",function(a,b){"use strict";a.defaults.xsrfCookieName="csrftoken",a.defaults.xsrfHeaderName="X-CSRFToken"}]).controller("RefineryFileUploadController",["$scope","$http","$filter","$window",function(a,b){"use strict";a.options={url:url,maxChunkSize:chunkSize,sequentialUploads:!0,autoUpload:!1,formData:getFormData,chunkdone:chunkDone,submit:uploadSubmit,done:uploadDone,fail:uploadFail},a.loadingFiles=!1}]).controller("RefineryFileDestroyController",["$scope","$http",function(a,b){"use strict";var c,d=a.file;d.url?(d.$state=function(){return c},d.$destroy=function(){return c="pending",b({url:d.deleteUrl,method:d.deleteType}).then(function(){c="resolved",a.clear(d)},function(){c="rejected"})}):d.$cancel||d._index||(d.$cancel=function(){a.clear(d)})}]);var url="/data_set_manager/import/chunked-upload/",chunkSize=1e7,md5={},formData=[],getFormData=function(a){"use strict";return formData},chunkDone=function(a,b){"use strict";2>formData&&formData.push({name:"upload_id",value:b.result.upload_id})},uploadSubmit=function(a,b){"use strict";calculate_md5(b.files[0],chunkSize)},uploadDone=function(a,b){"use strict";console.log("Finished uploading chunks for:",b.files[0].name,"md5 =",md5[b.files[0].name]),$.ajax({type:"POST",url:"/data_set_manager/import/chunked-upload-complete/",data:{upload_id:b.result.upload_id,md5:md5[b.files[0].name]},dataType:"json",success:function(a){console.log(a)}}),formData=[]},uploadFail=function(a,b){"use strict";console.log(b.errorThrown,b.textStatus)};
//# sourceMappingURL=data_file_upload.js.map