/*! refinery-platform-ui 2015-06-16 */

angular.module("refineryIgv",[]).controller("IgvController",["$scope","$rootScope","$http","$window","$log","$timeout","$resource",function(a,b,c,d,e,f,g){"use strict";a.igvConfig={query:null,annotation:null,node_selection:[],node_selection_blacklist_mode:!0},a.speciesList=[],a.speciesIndex=-1,a.message=null,a.messageType="info",a.isLoadingSpecies=!1,a.$onRootScope("nodeSetChangedEvent",function(b,c){a.message=null,a.messageType="info",a.speciesIndex=-1,a.detectSpecies()}),a.detectSpecies=function(){g("/api/v1/nodeset/",{format:"json"}).get({uuid:a.currentNodeSet.uuid},function(b){a.isLoadingSpecies=!0,e.info(b.objects[0].solr_query_components),e.info(JSON.parse(b.objects[0].solr_query_components).documentSelection),e.info(JSON.parse(b.objects[0].solr_query_components).documentSelectionBlacklistMode),a.igvConfig.query=b.objects[0].solr_query,a.igvConfig.node_selection=JSON.parse(b.objects[0].solr_query_components).documentSelection,a.igvConfig.node_selection_blacklist_mode=JSON.parse(b.objects[0].solr_query_components).documentSelectionBlacklistMode,a.igvConfig.annotation=null,c({method:"POST",url:"/solr/igv/",headers:{"X-Requested-With":"XMLHttpRequest"},dataType:"json",data:a.igvConfig}).success(function(b){0===b.species_count?a.message="Unable to detect species and genome build. Please select the correct genome and launch IGV.":1===b.species_count?(a.message=null,a.speciesIndex=0):a.message="Multiple species detected. Please select a genome and launch IGV. You may repeat this step multiple times.",a.speciesList.length=0;for(var c in b.species)b.species.hasOwnProperty(c)&&a.speciesList.push({name:c,url:b.species[c]});a.isLoadingSpecies=!1}).error(function(b,c){a.isLoadingSpecies=!1,a.messageType="error",a.message="Sorry! Unable to configure IGV for the selected file set.",e.error("Error creating IGV session URLs. (error status "+c+")")})},function(b){a.isLoadingSpecies=!1,a.messageType="error",a.message="Sorry! Unable to get the contents of the selected file set.",e.error("Error accessing Node Set API.")})},a.launchIgv=function(){d.open(a.speciesList[a.speciesIndex].url)}}]);
//# sourceMappingURL=igv.js.map