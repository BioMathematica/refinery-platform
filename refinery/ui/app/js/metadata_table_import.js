/*! refinery-platform-ui 2015-06-16 */

angular.module("refineryMetadataTableImport",["angularFileUpload","ngGrid"]).config(["$httpProvider",function(a){a.defaults.xsrfCookieName="csrftoken",a.defaults.xsrfHeaderName="X-CSRFToken"}]).factory("fileSources",["$http",function(a){"use strict";return{check:function(b,c,d){var e={method:"POST",url:"/data_set_manager/import/check_files/",headers:{"X-Requested-With":"XMLHttpRequest"},data:b};a(e).success(c).error(d)}}}]).controller("MetadataTableImportCtrl",["$scope","$log","$http","$modal","fileSources",function(a,b,c,d,e){"use strict";function f(a){var b=a.reduce(function(a,b){return a+String(b).length},0),c=[];return a.forEach(function(a){var d=String(a),e=d.length/b*100;10>e&&(e=Math.round(2*e)),c.push({field:d,width:e+"%"})}),c}a.gridOptions={data:"metadataSample",columnDefs:"columnDefs",enableColumnResize:!0},a.badFileList=[],a.onFileSelect=function(b){if(!b[0])return void a.$apply(function(){a.metadataSample=[],a.metadataHeader=[],a.columnDefs=[]});a.selectedFile=b[0],a.title=a.selectedFile.name.replace(/\.[^/.]+$/,"");var c=new FileReader;c.onload=function(b){a.$apply(function(){a.metadata=d3.tsv.parse(b.target.result),a.metadataSample=a.metadata.slice(0,5),a.metadataHeader=Object.keys(a.metadataSample[0]),a.columnDefs=f(a.metadataHeader)})},c.readAsText(a.selectedFile)},a.checkFiles=function(){var c={base_path:a.basePath,list:[]};a.dataFileColumn&&a.metadata.forEach(function(b){c.list.push(b[a.dataFileColumn])}),e.check(c,function(a){var b;b=a.length>0?{title:"The following files were not found on the server:",items:a}:{title:"All files were found on the server",items:a};d.open({templateUrl:"/static/partials/list_confirmation_dialog.tpls.html",controller:ConfirmationDialogInstanceCtrl,size:"lg",resolve:{config:function(){return b}}})},function(a,c){var d="Request failed: error "+c;b.error(d),alert(d)})}}]);var ConfirmationDialogInstanceCtrl=function(a,b,c){a.config=c,a.ok=function(){b.close()}};ConfirmationDialogInstanceCtrl.$inject=["$scope","$modalInstance","config"];
//# sourceMappingURL=metadata_table_import.js.map