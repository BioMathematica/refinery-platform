/*! refinery-platform-ui 2015-06-16 */

angular.module("refineryNodeRelationship",["ngResource"]).factory("nodeRelationshipResource",["$resource",function(a){"use strict";return a("/api/v1/noderelationship/:uuid/",{format:"json"},{update:{method:"PUT"},update_partial:{method:"PATCH"}})}]).factory("nodePairResource",["$resource","$http",function(a,b){"use strict";return a("/api/v1/nodepair/:uuid/",{format:"json"})}]).service("nodeRelationshipService",["$log","nodeRelationshipResource",function(a,b){var c=function(a,b,c,d){e(a,b,"",!0,c,d)},d=function(a,b,c,d,f){e(a,b,c,!1,d,f)},e=function(a,c,d,e,f,g){var h=new b({study:"/api/v1/study/"+externalStudyUuid+"/",assay:"/api/v1/assay/"+externalAssayUuid+"/",node_pairs:[],name:a,summary:c,type:d,is_current:e});h.$save(f,g)},f=function(c,d,e){a.debug("Deleting node relationship "+c.name+" ..."),c.is_current?a.error("Cannot delete current node relationship."):b["delete"]({uuid:c.uuid},d,e)},g=function(c,d,e){a.debug("Updating node relationship "+c.name+" ..."),c.is_current?a.error('Cannot update "current" node relationship.'):b.update({uuid:c.uuid},c,d,e)};return{createCurrentNodeRelationship:c,createNodeRelationship:d,deleteNodeRelationship:f,updateNodeRelationship:g}}]).controller("NodeRelationshipListCtrl",["$scope","$rootScope","$element","$log","$modal","nodeRelationshipResource","nodeRelationshipService",function(a,b,c,d,e,f,g){"use strict";a.$onRootScope("workflowChangedEvent",function(c,d){a.currentWorkflow=d,a.currentNodeRelationship=null,b.$emit("nodeRelationshipChangedEvent",a.currentNodeRelationship,void 0)}),a.$onRootScope("nodeRelationshipChangedEvent",function(b,c,e){a.nodeRelationshipIndex=e,d.debug(e),d.debug(a.nodeRelationshipList)});var h=function(b){d.debug(b),d.debug("Successfully deleted "+b.name),a.currentNodeRelationship=null,a.nodeRelationshipIndex=0,a.loadNodeRelationshipList(externalStudyUuid,externalAssayUuid),a.updateCurrentNodeRelationship()},i=function(b){a.loadNodeRelationshipList(externalStudyUuid,externalAssayUuid,b)},j=function(b){a.loadNodeRelationshipList(externalStudyUuid,externalAssayUuid,b)};a.loadNodeRelationshipList=function(b,c,e){return f.get({study__uuid:b,assay__uuid:c,order_by:["-is_current","name"]},function(b){(b.objects.length>0&&!b.objects[0].is_current||0===b.objects.length)&&g.createCurrentNodeRelationship("Current Mapping","1-N",function(){a.loadNodeRelationshipList(externalStudyUuid,externalAssayUuid)},function(a){d.error(a)}),a.nodeRelationshipList=b.objects,e&&(a.nodeRelationshipIndex=a.findNodeRelationshipListIndex(e),e>=0&&a.updateCurrentNodeRelationship())})},a.findNodeRelationshipListIndex=function(b){for(var c=0;c<a.nodeRelationshipList.length;++c)if(a.nodeRelationshipList[c].uuid===b.uuid)return c;return-1},a.updateCurrentNodeRelationship=function(){a.currentNodeRelationship=a.nodeRelationshipList[a.nodeRelationshipIndex],a.currentNodeRelationship&&b.$emit("nodeRelationshipChangedEvent",a.currentNodeRelationship,a.nodeRelationshipIndex)},a.openNewMappingDialog=function(){a.newMappingDialogConfig={title:"New File Mapping",text:"Enter a name for the mapping.",val:"New Mapping"};var b=e.open({templateUrl:"/static/partials/input_dialog.tpls.html",controller:InputDialogInstanceController,resolve:{config:function(){return a.newMappingDialogConfig}}});b.result.then(function(b){a.val=b,g.createNodeRelationship(b,"Test","1-N",i,function(a){alert("Error!"),console.log(a)})},function(){d.info("Modal dismissed at: "+new Date)})},a.openRenameMappingDialog=function(b){a.renameMappingDialogConfig={title:"Rename File Mapping",text:'Enter a new name for the mapping "'+b.name+'".',val:b.name};var c=e.open({templateUrl:"/static/partials/input_dialog.tpls.html",controller:InputDialogInstanceController,resolve:{config:function(){return a.renameMappingDialogConfig}}});c.result.then(function(c){a.val=c,b.name=c,g.updateNodeRelationship(b,j,function(a){d.error("Error!"),d.error(a)})},function(){d.info("Modal dismissed at: "+new Date)})},a.openDeleteMappingDialog=function(b){a.newDeleteMappingDialogConfig={title:"Delete File Mapping?",text:'Are you sure you want to delete the file mapping "'+b.name+'"?'};var c=e.open({templateUrl:"/static/partials/confirmation_dialog.tpls.html",controller:ConfirmationDialogInstanceController,resolve:{config:function(){return a.newDeleteMappingDialogConfig}}});c.result.then(function(){g.deleteNodeRelationship(b,h,function(a){d.error("Error!"),d.error(a)})},function(){d.info("Modal dismissed at: "+new Date)})};a.loadNodeRelationshipList(externalStudyUuid,externalAssayUuid)}]);var InputDialogInstanceController=function(a,b,c){a.config=c,a.val={val:a.config.val},a.ok=function(){b.close(a.config.val)},a.cancel=function(){b.dismiss("cancel")}};InputDialogInstanceController.$inject=["$scope","$modalInstance","config"];var ConfirmationDialogInstanceController=function(a,b,c){a.config=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}};ConfirmationDialogInstanceController.$inject=["$scope","$modalInstance","config"];
//# sourceMappingURL=node_relationship.js.map