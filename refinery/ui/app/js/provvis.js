/*! refinery-platform-ui 2015-06-16 */

angular.module("refineryProvvis",[]).controller("provvisNavbarController",["$scope",function(a){a.name="Navbar"}]).controller("provvisCanvasController",["$scope",function(a){a.name="Canvas"}]).directive("provvisNavBar",function(){return{templateUrl:"/static/partials/provvis_navbar.tpls.html",restrict:"A"}}).directive("provvisCanvas",function(){return{templateUrl:"/static/partials/provvis_canvas.tpls.html",restrict:"A"}});var provvis=function(){var a=Object.create(null),b=function(a){var b=d3.select("#"+a);$("<p/>",{id:"tlTitle",html:"Analysis Timeline"}).appendTo(b),$("<p/>",{id:"tlThresholdStart","class":"tlThreshold"}).appendTo(b),$("<p/>",{id:"tlCanvas"}).appendTo(b),d3.select("#tlCanvas").append("svg").attr("height",80).attr("width",275).style({"margin-top":"0px","margin-bottom":"0px",padding:"0px"}).attr("pointer-events","all"),$("<p/>",{id:"tlThresholdEnd","class":"tlThreshold"}).appendTo(b)},c=function(a){var b=d3.select("#"+a);$("<p/>",{id:"doiTitle",html:"DOI Components"}).appendTo(b),$("<div/>",{id:"doiVis",style:"width: 100%; height: 300px;"}).appendTo(b),$("<div/>",{id:"doiCanvas",style:"width: 70px; float: left;"}).appendTo("#doiVis"),d3.select("#doiCanvas").append("svg").attr("height",300).attr("width",100).style({"margin-top":"0px","margin-left":"0px",padding:"0px"}).attr("pointer-events","all").append("g").append("g").attr("transform",function(){return"translate(0,0)"}).append("g"),$("<button/>",{id:"prov-doi-view-apply","class":"btn btn-primary",type:"button",html:"Apply",style:"position: absolute; left: 0px; top: 340px;"}).appendTo(b),$("<label/>",{id:"prov-doi-view-show","class":"prov-doi-view-show-checkbox",style:"display: flex; position: absolute; left: 75px; top: 340px; margin-top: 5px;",html:'<input id="prov-doi-view-show-input" type="checkbox" style="margin-right: 3px;">Show DOI values'}).appendTo(b)},d=function(a){var b=d3.select("#"+a);$("<p/>",{id:"changeLayerTitle",html:"Change Layering"}).appendTo(b),$("<div/>",{id:"prov-layering-method","class":"btn-group","data-toggle":"buttons-radio"}).appendTo(b),$("<button/>",{id:"prov-layering-strict","class":"btn btn-primary",type:"button",value:"strict",html:"Hard"}).appendTo("#prov-layering-method"),$("<button/>",{id:"prov-layering-weak","class":"active btn btn-primary",type:"button",value:"weak",html:"Soft"}).appendTo("#prov-layering-method")},e=function(){$("<div>",{id:"provvis-loader"}).appendTo("#main-area"),$("<i>",{"class":"icon-spinner spin-icon-infinite",id:"provvis-loader-icon"}).appendTo("#provvis-loader")},f=function(){$("#provvis-loader").remove()},g=function(g,h,i){if(e(),a instanceof provvisDecl.ProvVis==!1){var j="/api/v1/node?study__uuid="+g+"&format=json&limit=0",k=h.filter(function(a){return"SUCCESS"===a.status});d3.json(j,function(g,h){var l=Object.create(null),m=Object.create(null),n=Object.create(null),o={top:20,right:10,bottom:20,left:10},p=7,q=d3.scale.category20(),r=Object.create(null);b("provenance-timeline-view"),c("provenance-doi-view"),d("provenance-layer-change-view");var s={width:5*p,height:3*p},t=$("div#provenance-canvas").width()-o.left-o.right,u=740-o.top-o.bottom,v=.75,w="weak";a=new provvisDecl.ProvVis("provenance-graph",l,h,j,m,n,o,t,u,p,q,r,s,w);var x=function(){a.canvas.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")"),d3.event.scale<1?d3.selectAll(".BBox").classed("hiddenNode",!0):d3.selectAll(".BBox").classed("hiddenNode",!1),d3.event.scale<1.75?(a.canvas.selectAll(".anLabel, .sanLabel, .lnLabel, .nodeAttrLabel, .stored-node-type-icon, .an-node-type-icon, .san-node-type-icon, .l-node-type-icon, .lBBoxLabel, .aBBoxLabel, .nodeDoiLabel").classed("hiddenLabel",!0),d3.selectAll(".glAnchor, .grAnchor").classed("hiddenNode",!0),d3.selectAll(".lDiff, .aDiff").classed("hiddenNode",!0)):(a.canvas.selectAll(".anLabel, .sanLabel, .lnLabel, .nodeAttrLabel, .stored-node-type-icon, .an-node-type-icon, .san-node-type-icon, .l-node-type-icon, .lBBoxLabel, .aBBoxLabel, .nodeDoiLabel").classed("hiddenLabel",!1),d3.selectAll(".glAnchor, .grAnchor").classed("hiddenNode",!1),d3.selectAll(".lDiff, .aDiff").classed("hiddenNode",!1)),d3.event.scale<2.5?d3.selectAll(".lDiffLabel, .aDiffLabel").classed("hiddenLabel",!0):d3.selectAll(".lDiffLabel, .aDiffLabel").classed("hiddenLabel",!1),a.rect.attr("transform","translate("+-(d3.event.translate[0]+a.margin.left)/d3.event.scale+","+-(d3.event.translate[1]+a.margin.top)/d3.event.scale+") scale("+1/d3.event.scale+")"),a.canvas.selectAll(".lBBoxLabel").attr("transform","translate("+1*v*a.radius+","+.5*v*a.radius+")scale("+1/d3.event.scale+")"),a.canvas.selectAll(".aBBoxLabel").attr("transform","translate("+1*v*a.radius+","+.5*v*a.radius+")scale("+1/d3.event.scale+")"),a.canvas.selectAll(".nodeDoiLabel").attr("transform","translate(0,"+1.6*v*a.radius+")scale("+1/d3.event.scale+")"),a.canvas.selectAll(".nodeAttrLabel").attr("transform","translate("+-1.5*v*a.radius+","+-1.5*v*a.radius+")scale("+1/d3.event.scale+")")};a.canvas=d3.select("#provenance-canvas").append("svg").attr("transform","translate("+a.margin.left+","+a.margin.top+")").attr("viewBox","0 0 "+t+" "+u).attr("preserveAspectRatio","xMinYMin meet").attr("pointer-events","all").classed("canvas",!0).append("g").call(a.zoom=d3.behavior.zoom().on("zoom",x)).on("dblclick.zoom",null).append("g"),a.rect=a.canvas.append("svg:rect").attr("width",t).attr("height",u).classed("brect",!0),a.graph=provvisInit.run(h,k,i),a.graph.bclgNodes=provvisLayout.run(a.graph,a.cell),provvisMotifs.run(a.graph,w),provvisRender.run(a),f(),$("#prov-layering-method > button").click(function(){w=$(this).prop("value"),e(),$(".aHLinks").remove(),$(".aLinks").remove(),$(".lLinks").remove(),$(".lLink").remove(),$(".layers").remove(),$(".analyses").remove(),$("#provenance-timeline-view").children().remove(),$("#provenance-doi-view").children().remove(),b("provenance-timeline-view"),provvisDecl.DoiFactors.set("filtered",.2,!0),provvisDecl.DoiFactors.set("selected",.2,!0),provvisDecl.DoiFactors.set("highlighted",.2,!0),provvisDecl.DoiFactors.set("time",.2,!0),provvisDecl.DoiFactors.set("diff",.2,!0),c("provenance-doi-view"),provvisMotifs.run(a.graph,w),provvisRender.run(a),f()})})}},h=function(b){provvisRender.runRenderUpdate(a,b)},i=function(){return a};return{run:function(a,b,c){g(a,b,c)},update:function(a){h(a)},get:function(){return i()}}}();
//# sourceMappingURL=provvis.js.map