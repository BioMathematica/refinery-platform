/*! refinery-platform-ui 2015-06-16 */

var provvisInit=function(){var a=Object.create(null),b=[],c=[],d=[],e=[],f=[],g=[],h=[],i=d3.map(),j=d3.map(),k=d3.map(),l=d3.map(),m=d3.map(),n=[],o=function(a){var b="";switch(a.type){case"Source Name":case"Sample Name":case"Assay Name":b="special";break;case"Data Transformation Name":b="dt";break;default:b=null===a.file_url?"intermediate":"stored"}return b},p=function(a,b,c){var d=null!==a.study?a.study.replace(/\/api\/v1\/study\//g,"").replace(/\//g,""):"",e=null!==a.assay?a.assay.replace(/\/api\/v1\/assay\//g,"").replace(/\//g,""):"",f=a.parents.map(function(a){return a.replace(/\/api\/v1\/node\//g,"").replace(/\//g,"")}),g=null!==a.analysis_uuid?a.analysis_uuid:"dataset";return new provvisDecl.Node(c,b,Object.create(null),!0,a.name,a.type,d,e,f,g,a.subanalysis,a.uuid,a.file_url)},q=function(a){d3.values(a.value).forEach(function(a,c){var d=o(a),e=p(a,d,c);b.push(e),i.set(a.uuid,e),m.set(a.uuid,a)})},r=function(a,b,c){return new provvisDecl.Link(a,b,c,!0)},s=function(){var a=0;b.forEach(function(b){"undefined"!=typeof b.uuid?"undefined"!=typeof b.parents?b.parents.forEach(function(d){"undefined"!=typeof i.get(d)?(c.push(r(a,i.get(d),b)),a++):console.log("ERROR: Dataset might be corrupt - parent: "+d+" of node with uuid: "+b.uuid+" does not exist.")}):console.log("Error: Parents array of node with uuid: "+b.uuid+" is undefined!"):console.log("Error: Node uuid is undefined!")})},t=function(){c.forEach(function(a){a.source.succs.set(a.target.autoId,a.target),a.source.succLinks.set(a.autoId,a),a.target.preds.set(a.source.autoId,a.source),a.target.predLinks.set(a.autoId,a)}),b.forEach(function(a){a.succs.empty()?f.push(a):a.preds.empty()&&e.push(a)})},u=function(){var a=0,b=function(a,d){a.subanalysis=d,a.preds.values().forEach(function(a){null===a.subanalysis&&b(a,d)}),a.succs.values().forEach(function(a){null===a.subanalysis&&c(a,d)})},c=function(a,d){a.subanalysis=d,a.preds.size()>1&&a.preds.values().forEach(function(a){null===a.subanalysis&&b(a,d)}),a.succs.values().forEach(function(a){"dataset"!==a.analysis&&(null===a.subanalysis?a.succs.empty()||(d=a.succs.values()[0].subanalysis):d=a.subanalysis),c(a,d)})};e.forEach(function(b){null===b.subanalysis&&(c(b,a),a++)})},v=function(a,b){return new provvisDecl.Analysis(b,Object.create(null),!0,a.uuid,a.workflow__uuid,b,a.time_start.substr(0,a.time_start.length-3),a.time_end.substr(0,a.time_end.length-3),a.creation_date.substr(0,a.creation_date.length-3))},w=function(a){a.forEach(function(a){var b=function(a){var b=a.replace(/u'/g,'"');return b=b.replace(/\'/g,'"'),b=b.replace(/\sNone/g,' "None"'),b=b.replace(/\\/g,""),b=b.replace(/\"{\"/g,'{"'),b=b.replace(/}\"/g,"}"),b=b.replace(/\"\"(\S+)\"\"/g,'"$1"'),b=b.replace(/\"__(\S*)__\":\s{1}\d*(,\s{1})?/g,""),b=b.replace(/,\s{1}null/g,""),b=b.replace(/,\s{1}}/g,"}")},c=b(a.workflow_copy),d=JSON.parse(c),e=d;k.set(a.workflow__uuid,e)})},x=function(b){var c=d3.time.format.iso(new Date(0));b.length>0&&(c=d3.min(b,function(a){return new Date(a.time_start)}),c.setSeconds(c.getSeconds()-1),c=d3.time.format.iso(c)),c=c.substr(0,c.length-1),a=new provvisDecl.Analysis(0,Object.create(null),!0,"dataset","dataset",0,c,c,c),g.push(a),j.set("dataset","dataset"),b.forEach(function(a,b){g.push(v(a,b+1)),j.set(a.uuid,a.workflow__uuid),l.set(a.uuid,a)})},y=function(a,b,c){return new provvisDecl.Subanalysis(a,b,!0,c)},z=function(){var a=0;g.forEach(function(c){b.filter(function(a){return a.analysis===c.uuid}).forEach(function(b){if(!c.children.has(b.subanalysis)){var d=y(a,c,b.subanalysis);h.push(d),c.children.set(b.subanalysis,d),a++}})}),h.forEach(function(a){b.filter(function(b){return a.parent.uuid===b.analysis&&b.subanalysis===a.subanalysis}).forEach(function(b){a.children.set(b.autoId,b)}),a.children.values().forEach(function(b){b.parent=a}),a.children.values().filter(function(b){return b.preds.values().some(function(b){return b.analysis!==a.parent.uuid})||b.preds.empty()}).forEach(function(b){a.inputs.set(b.autoId,b)}),a.children.values().filter(function(b){return b.succs.empty()||b.succs.values().some(function(b){return b.analysis!==a.parent.uuid})}).forEach(function(b){a.outputs.set(b.autoId,b)})}),h.forEach(function(a){a.inputs.values().forEach(function(b){b.preds.values().forEach(function(b){a.preds.has(b.parent.autoId)||a.preds.set(b.parent.autoId,b.parent)})}),a.outputs.values().forEach(function(b){b.succs.values().forEach(function(b){a.succs.has(b.parent.autoId)||a.succs.set(b.parent.autoId,b.parent)})})}),h.forEach(function(a){a.inputs.values().forEach(function(b){b.predLinks.values().forEach(function(b){a.predLinks.set(b.autoId,b)})}),a.outputs.values().forEach(function(b){b.succLinks.values().forEach(function(b){a.succLinks.set(b.autoId,b)})})}),h.forEach(function(a){c.filter(function(b){return null!==b&&a.parent.uuid===b.source.analysis&&b.source.subanalysis===a.subanalysis}).forEach(function(b){a.parent.uuid===b.target.analysis?a.links.set(b.autoId,b):d.push(b)})}),g.forEach(function(a){a.children.values().forEach(function(b){b.inputs.entries().forEach(function(b){a.inputs.set(b.key,b.value)}),b.outputs.entries().forEach(function(b){a.outputs.set(b.key,b.value)}),b.wfUuid=a.wfUuid});var b=k.get(a.wfUuid);a.wfName="undefined"==typeof b?"dataset":b.name,a.wfName.indexOf("5 steps")>-1?a.wfCode="5STPS":a.wfName.indexOf("analog")>-1?a.wfCode="SPP":a.wfCode="N/A"}),g.forEach(function(a){a.children.values().forEach(function(b){b.preds.values().forEach(function(b){a.preds.has(b.parent.autoId)||a.preds.set(b.parent.autoId,b.parent)})}),a.children.values().forEach(function(b){b.succs.values().forEach(function(b){a.succs.has(b.parent.autoId)||a.succs.set(b.parent.autoId,b.parent)})})}),g.forEach(function(a){a.children.values().forEach(function(b){b.links.values().forEach(function(b){a.links.set(b.autoId,b)})})}),g.forEach(function(a){a.inputs.values().forEach(function(b){b.predLinks.values().forEach(function(b){a.predLinks.set(b.autoId,b)})}),a.outputs.values().forEach(function(b){b.succLinks.values().forEach(function(b){a.succLinks.set(b.autoId,b)})})})},A=function(a){a instanceof SolrResponse&&a.getDocumentList().forEach(function(a){var b=i.get(a.uuid),c=d3.entries(a);c.forEach(function(a){var c=a.key.indexOf("_Characteristics_"),d="";-1===c?(d=a.key.replace(/REFINERY_/g,""),d=d.replace(/_([0-9])+_([0-9])+_s/g,""),d=d.toLowerCase()):d=a.key.substr(0,c),b.attributes.set(d,a.value)})})},B=function(a){if(a instanceof SolrResponse&&a.getDocumentList().length>0){var b=a.getDocumentList()[0],c=d3.entries(b);c.forEach(function(a){var b=a.key.indexOf("_Characteristics_"),c="";-1===b?(c=a.key.replace(/REFINERY_/g,""),c=c.replace(/_([0-9])+_([0-9])+_s/g,""),c=c.toLowerCase()):c=a.key.substr(0,b),n.push(c)})}n.forEach(function(a){$("<li/>",{id:"prov-ctrl-visible-attribute-list-"+a,html:'<a href="#" class="field-name"><label class="radio" style="text-align: start"><input type="radio">'+a+"</label></a>"}).appendTo("#prov-ctrl-visible-attribute-list")}),$("#prov-ctrl-visible-attribute-list-name").find("input").prop("checked",!0)},C=function(a){a.aNodes.forEach(function(b){b.parent=a})},D=function(n,o,p){var r=d3.entries(n)[1];q(r,p),s(),t(),x(o),w(o),u(),z(),A(p),B(p);var v=new provvisDecl.ProvGraph(a,b,c,d,e,f,g,h,j,i,l,k,m);return C(v),v};return{run:function(a,b,c){return D(a,b,c)}}}();
//# sourceMappingURL=provvis_init.js.map