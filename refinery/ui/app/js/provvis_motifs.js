/*! refinery-platform-ui 2015-06-16 */

var provvisMotifs=function(){var a=function(a,b){var c=[],d=d3.map(),e=0;return a.bclgNodes.forEach(function(f,g){var h=d3.map();f.sort(function(a,b){return parseISOTimeFormat(a.start)-parseISOTimeFormat(b.start)}).forEach(function(a){var c=!1,d=null,e=d3.map(),f=d3.map();if(a.predLinks.values().forEach(function(a){e.set(a.source.autoId,a.source)}),a.succLinks.values().forEach(function(a){f.set(a.target.autoId,a.target)}),h.values().forEach(function(f){(f.wfUuid===a.wfUuid&&"weak"===b||f.wfUuid===a.wfUuid&&"strict"===b&&f.numSubanalyses===a.children.size()&&a.predLinks.size()===f.numIns&&a.succLinks.size()===f.numOuts)&&("dataset"===a.preds.values()[0].uuid&&compareMaps(e,f.preds)||"dataset"!==a.preds.values()[0].uuid)&&(c=!0,d=f)}),c)a.motif=d;else{var g=new provvisDecl.Motif;a.predLinks.values().forEach(function(a){g.preds.set(a.source.autoId,a.source)}),a.succLinks.values().forEach(function(a){g.succs.set(a.target.autoId,a.target)}),g.numIns=a.predLinks.size(),g.numOuts=a.succLinks.size(),g.wfUuid=a.wfUuid,g.numSubanalyses=a.children.size(),h.set(g.autoId,g),a.motif=g}}),c.push(d3.map()),f.forEach(function(b){var f=b.preds.values().map(function(a){return a.motif.autoId}),h=Object.create(null);c[g].has(f+"-"+b.motif.autoId)?(h=d.get(c[g].get(f+"-"+b.motif.autoId)),h.children.set(b.autoId,b),b.layer=h):(h=new provvisDecl.Layer(e,b.motif,a,!1),h.children.set(b.autoId,b),b.layer=h,d.set(h.autoId,b.layer),e++,c[g].set(f+"-"+b.motif.autoId,h.autoId))})}),d},b=function(a){a.lNodes.values().forEach(function(b){b.children.values().forEach(function(a){a.parent=a.layer,a.inputs.values().forEach(function(a){b.inputs.set(a.autoId,a)}),a.outputs.values().forEach(function(a){b.outputs.set(a.autoId,a)})});var c="dataset";"undefined"!=typeof a.workflowData.get(b.motif.wfUuid)&&(c=a.workflowData.get(b.motif.wfUuid).name),b.wfName=c.toString(),b.wfCode=b.children.values()[0].wfCode,b.parent=a,b.children.size()<=1&&(b.hidden=!0),1===b.children.size()&&(b.children.values()[0].hidden=!1,b.children.values()[0].predLinks.values().forEach(function(a){a.hidden=!1}),b.children.values()[0].succLinks.values().forEach(function(a){a.hidden=!1}))}),a.lNodes.values().forEach(function(a){a.children.values().forEach(function(b){b.preds.values().forEach(function(b){a.preds.has(b.layer.autoId)||a.preds.set(b.layer.autoId,b.layer)})}),a.children.values().forEach(function(b){b.succs.values().forEach(function(b){a.succs.has(b.layer.autoId)||a.succs.set(b.layer.autoId,b.layer)})})}),a.lNodes.values().forEach(function(a){a.children.values().forEach(function(b){b.links.values().forEach(function(b){a.links.set(b.autoId,b)})})});var b=0;a.lNodes.values().forEach(function(c){c.succs.values().forEach(function(d){var e=new provvisDecl.Link(b,c,d,c.hidden||d.hidden);a.lLinks.set(e.autoId,e),c.succLinks.set(e.autoId,e),d.predLinks.set(e.autoId,e),b++})})},c=function(a){a.aNodes.sort(function(a,b){return parseISOTimeFormat(a.start)-parseISOTimeFormat(b.start)}).forEach(function(a){1!==a.parent.children.size()&&(a.motifDiff.numSubanalyses=a.children.size()-a.motif.numSubanalyses,a.motifDiff.numIns=a.predLinks.size()-a.motif.numIns,a.motifDiff.numOuts=a.succLinks.size()-a.motif.numOuts)})},d=function(a){a.aNodes.forEach(function(b){b.layer=Object.create(null),b.motif=Object.create(null),b.parent=a,b.motifDiff={numIns:0,numOuts:0,wfUuid:b.wfUuid,numSubanalyses:0}}),a.lNodes=d3.map(),a.lLinks=d3.map()},e=function(e,f){d(e),e.lNodes=a(e,f),b(e),c(e)};return{run:function(a,b){return e(a,b)}}}();
//# sourceMappingURL=provvis_motifs.js.map