/*! refinery-platform-ui 2015-06-16 */

var provvisRender=function(){var a=Object.create(null),b=Object.create(null),c=Object.create(null),d=Object.create(null),e=Object.create(null),f=Object.create(null),g=[],h=Object.create(null),i=Object.create(null),j=Object.create(null),k=Object.create(null),l=Object.create(null),m=Object.create(null),n=Object.create(null),o=Object.create(null),p=Object.create(null),q=Object.create(null),r=Object.create(null),s=d3.map(),t=0,u=0,v=Object.create(null),w=Object.create(null),x="timeline",y=Object.create(null),z=Object.create(null),A=d3.map(),B=!1,C=1e3,D=[],E=[],F=[],G=[],H=d3.map(),I=d3.map(),J=.75,K=d3.map(),L="bezier1",M="#136382",N="#ed7407",O=!0,P=Object.create(null),Q=d3.select("body").append("div").attr("class","refinery-tooltip").style("position","absolute").style("z-index","10").style("visibility","hidden"),R=function(){var b=function(a){for(var b=a;!(b instanceof provvisDecl.Layer);){if(!(b instanceof provvisDecl.Layer||b.parent.hidden))return!1;b=b.parent}return!0};g.select(".nodeDoiLabel").text(function(a){return a.doi.doiWeightedSum}),a.graph.lNodes.values().forEach(function(a){a.doi.doiWeightedSum>=.25&&!a.hidden&&a.filtered&&wa(a,"e","auto")}),a.graph.aNodes.forEach(function(a){a.doi.doiWeightedSum>=.5&&!a.hidden&&a.filtered?wa(a,"e","auto"):a.doi.doiWeightedSum<.25&&!a.hidden&&a.parent.children.size()>1&&(wa(a,"c","auto"),a.parent.filtered&&a.parent.children.values().forEach(function(b){b.doi.doiWeightedSum>=.25?(b.exaggerated=!0,b.hidden=!1,d3.select("#nodeId-"+b.autoId).classed("hiddenNode",!1),Z(b),b.doi.doiWeightedSum>=.5&&!b.hidden&&b.filtered&&wa(b,"e","auto")):(b.exaggerated=!1,b.hidden=!0,d3.select("#nodeId-"+a.autoId).classed("hiddenNode",!0))}))}),a.graph.saNodes.forEach(function(a){var c=d3.max(a.children.values(),function(a){return a.doi.doiWeightedSum});.75>c&&(b(a.children.values()[0])||a.parent.exaggerated)&&wa(a.children.values()[0],"c","auto")}),a.graph.saNodes.forEach(function(a){var c=d3.max(a.parent.children.values(),function(a){return a.doi.doiWeightedSum});a.doi.doiWeightedSum>=.75&&!a.hidden&&a.filtered?wa(a,"e","auto"):.5>c&&(b(a)||a.parent.exaggerated)&&wa(a,"c","auto")}),va(a.graph),O&&ya(C)},S=function(a,b){Q.html(a),Q.style("visibility","visible"),Q.style("top",b.pageY+10+"px"),Q.style("left",b.pageX+10+"px")},T=function(){Q.style("visibility","hidden")},U=function(a,b,c,d){a.transition().duration(B?0:C).attr("transform","translate("+c+","+d+")")},V=function(a){for(var b=0,c=0;a.hidden&&!(a instanceof provvisDecl.Layer);)a=a.parent;if(a instanceof provvisDecl.Layer)b=a.x,c=a.y;else for(;!(a instanceof provvisDecl.Layer);)b+=a.x,c+=a.y,a=a.parent;return{x:b,y:c}},W=function(c,d,e,f,g){var h="M"+d+","+e;if(f-d>1.5*a.cell.width){var i=c.source,j=d;if(c.source instanceof provvisDecl.Layer||c.target instanceof provvisDecl.Layer||c.source.parent!==c.target.parent){for(;!(i instanceof provvisDecl.Analysis||i instanceof provvisDecl.Layer);)i=i.parent;i instanceof provvisDecl.Analysis&&!i.parent.hidden&&c.source.hidden&&(i=i.parent),j=c.source instanceof provvisDecl.Layer&&c.source.hidden?d+a.cell.width/2:ta(i,0).x.max-a.cell.width/2,K.values().forEach(function(b){if(-1!==b.nodes.indexOf(i.autoId)){var c=ta(i,0).x.max-ta(i,0).x.min,e=(b.width-c)/2+a.cell.width/2;c<b.width&&(j=d+e)}}),h=h.concat(" H"+j)}h=h.concat(" C"+(j+b.width/3)+","+e+" "+(j+b.width/2-b.width/3)+","+g+" "+(j+b.width/2)+","+g+" H"+f)}else h=h.concat(" C"+(d+b.width)+","+e+" "+(f-b.width)+","+g+" "+f+","+g+" ");return h},X=function(a,b,c,d,e){return W(a,b,c,d,e)},Y=function(a,b,c,d,e){var f=" M"+b+","+c;return f=f.concat(" L"+d+","+e)},Z=function(a){var b=d3.map(),c=d3.map();switch(a.nodeType){case"layer":a.predLinks.values().forEach(function(a){b.set(a.autoId,a)}),a.succLinks.values().forEach(function(a){c.set(a.autoId,a)}),a.children.values().forEach(function(a){a.predLinks.values().forEach(function(a){b.set(a.autoId,a)}),a.succLinks.values().forEach(function(a){c.set(a.autoId,a)})});break;case"analysis":a.predLinks.values().forEach(function(a){b.set(a.autoId,a)}),a.succLinks.values().forEach(function(a){c.set(a.autoId,a)})}b.values().forEach(function(a){d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("link-transition",!0).transition().duration(B?0:C).attr("d",function(a){var b=V(a.source),c=V(a.target);return"bezier1"===L?X(a,b.x,b.y,c.x,c.y):Y(a,b.x,b.y,c.x,c.y)}),setTimeout(function(){d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("link-transition",!1)},C)}),c.values().forEach(function(a){d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("link-transition",!0).transition().duration(B?0:C).attr("d",function(a){var b=V(a.target),c=V(a.source);return"bezier1"===L?X(a,c.x,c.y,b.x,b.y):Y(a,c.x,c.y,b.x,b.y)}),setTimeout(function(){d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("link-transition",!1)},C)})},_=function(){d3.event.sourceEvent.stopPropagation()},aa=function(b){var c=d3.select(this);T();var d=d3.event.y-b.y;b.x=d3.event.x,b.y=d3.event.y,U(c,b,d3.event.x,d3.event.y),Z(b),b instanceof provvisDecl.Layer&&b.children.values().forEach(function(c){c.x=b.x-(ta(c,0).x.max-ta(c,0).x.min)/2+a.cell.width/2,c.y+=d,U(d3.select("#gNodeId-"+c.autoId),c,c.x,c.y),Z(c)}),B=!0},ba=function(a,b){var c=b;U(c,a,a.x,a.y),Z(a),a instanceof provvisDecl.Layer&&a.children.values().forEach(function(a){U(d3.select("#gNodeId-"+a.autoId),a,a.x,a.y),Z(a)})},ca=function(a){if(B){var b=d3.select(this);ba(a,b),setTimeout(function(){B=!1},200)}},da=function(a){var b=d3.behavior.drag().origin(function(a){return a}).on("dragstart",_).on("drag",aa).on("dragend",ca);a.call(b)},ea=function(a,b,c){c.graph.lNodes=I,c.graph.aNodes=D,c.graph.saNodes=E,c.graph.nodes=F,c.graph.aLinks=G,c.graph.lLinks=H;var d=c.graph.aNodes.filter(function(c){return b.setSeconds(b.getSeconds()+1),parseISOTimeFormat(c.start)>=a&&parseISOTimeFormat(c.start)<=b});if(c.graph.aNodes.forEach(function(a){-1===d.indexOf(a)?(a.filtered=!1,a.children.values().forEach(function(a){a.filtered=!1,a.children.values().forEach(function(a){a.filtered=!1})})):(a.filtered=!0,a.children.values().forEach(function(a){a.filtered=!0,a.children.values().forEach(function(a){a.filtered=!0})}))}),c.graph.aNodes.forEach(function(a){a.children.values().some(function(a){return a.filtered})?a.filtered=!0:a.filtered=!1,a.doi.filteredChanged()}),c.graph.lNodes.values().forEach(function(a){a.children.values().some(function(a){return a.filtered})?a.filtered=!0:a.filtered=!1,a.doi.filteredChanged()}),c.graph.aLinks.forEach(function(a){a.filtered=!1}),c.graph.aLinks.filter(function(a){return a.source.parent.parent.filtered&&a.target.parent.parent.filtered}).forEach(function(a){a.filtered=!0}),c.graph.lLinks.values().forEach(function(a){a.filtered=!1}),c.graph.lLinks.values().filter(function(a){return a.source.filtered&&a.target.filtered}).forEach(function(a){a.filtered=!0}),"hide"===w){var e=d3.map();c.graph.lNodes.entries().forEach(function(a){a.value.filtered&&e.set(a.key,a.value)}),c.graph.lNodes=e,c.graph.aNodes=c.graph.aNodes.filter(function(a){return a.filtered}),c.graph.saNodes=c.graph.saNodes.filter(function(a){return a.filtered}),c.graph.nodes=c.graph.nodes.filter(function(a){return a.filtered}),c.graph.aLinks=c.graph.aLinks.filter(function(a){return a.filtered});var f=d3.map();c.graph.lLinks.entries().forEach(function(a){a.value.filtered&&f.set(a.key,a.value)}),c.graph.lLinks=f}va(c.graph),O&&ya(C),Qa(),Ra(),ka(c.graph),na(c.graph.lLinks),c.graph.aNodes.forEach(function(a){Z(a)}),c.graph.lNodes.values().forEach(function(a){Z(a)})},fa=function(a){var b=d3.select("#provenance-timeline-view").select("svg").append("g").append("g").attr("transform",function(){return"translate(20,0)"}),c=50,d=250,e=d3.scale.linear().domain([0,d]).range([0,d]),f=d3.scale.linear().domain([5,0]).range([0,c-10]);y=d3.time.scale().domain([Date.parse(v.domain()[0]),Date.parse(v.domain()[1])]).range([0,d]).nice();var g=d3.svg.axis().scale(y).orient("bottom").ticks(5),h=d3.svg.axis().scale(f).orient("left").ticks(7),i=d3.map();D.forEach(function(a){i.set(a.autoId,y(parseISOTimeFormat(a.start)))});var j=function(){d3.event.sourceEvent.stopPropagation()},k=function(a){var b=Object.create(null),c=Object.create(null);return"startTimeline"===a.className?(b=a.time,c=d3.select(".endTimeline").data()[0].time):(b=d3.select(".startTimeline").data()[0].time,c=a.time),[b,c]},l=function(a){var b=k(a);b[1].setSeconds(b[1].getSeconds()+1);var c=customTimeFormat(b[0]),d=customTimeFormat(b[1]);d3.select("#tlThresholdStart").html("Start: "+c),d3.select("#tlThresholdEnd").html("End: "+d),d3.selectAll(".tlAnalysis").each(function(a){parseISOTimeFormat(a.start)<b[0]||parseISOTimeFormat(a.start)>b[1]?d3.select(this).classed("blendedTLAnalysis",!0):d3.select(this).classed("blendedTLAnalysis",!1)})},m=function(b){d3.event.x<0?b.x=0:d3.event.x>d?b.x=d:b.x=d3.event.x,b.time=new Date(y.invert(b.x)),d3.select(this).attr("transform",function(){return"translate("+e(b.x)+",0)"}),l(b),d3.entries(i).some(function(a){return"startTimeline"===b.className?b.x>b.lastX?e(b.x)-e(a.value)>0&&e(b.x)-e(a.value)<=1?!0:!1:e(b.x)-e(a.value)>=-1&&e(b.x)-e(a.value)<0?!0:!1:b.x<b.lastX?e(b.x)-e(a.value)>=-5&&e(b.x)-e(a.value)<0?!0:!1:e(b.x)-e(a.value)>0&&e(b.x)-e(a.value)<=1?!0:!1})&&ea(k(b)[0],k(b)[1],a),b.lastX=b.x},n=function(b){b.time=new Date(y.invert(b.x)),l(b),ea(k(b)[0],k(b)[1],a),x="timeline"},o=function(a){var b=d3.behavior.drag().origin(function(a){return a}).on("dragstart",j).on("drag",m).on("dragend",n);a.call(b)},p=function(){b.selectAll(".tlAnalysis").attr("x1",function(a){return e(y(parseISOTimeFormat(a.start)))}).attr("x2",function(a){return e(y(parseISOTimeFormat(a.start)))}),b.selectAll(".startTimeline, .endTimeline").attr("transform",function(a){return"translate("+e(a.x)+",0)"}),b.select("#timelineView").attr("x",e(0)).attr("width",e(d)-e(0)),b.select("#tlxAxis").attr("transform",function(){return"translate("+e(0)+","+c+")"}),b.select("#tlxAxis").selectAll(".tick").attr("transform",function(a){return"translate("+(e(y(a))-d3.event.translate[0])+",0)"}),b.select("#tlxAxis").select("path").attr("d",function(){return"M0,6V0H"+d*d3.event.scale+"V6"}),b.select("#tlyAxis").attr("transform",function(){return"translate("+e(0)+",10)"})},q=d3.behavior.zoom().x(e).scaleExtent([1,10]).on("zoom",p);q(b);var r=b.append("defs").append("linearGradient").attr("id","gradientGrayscale");r.append("stop").attr("offset","0%").attr("stop-color","#fff").attr("stop-opacity",1),r.append("stop").attr("offset","100%").attr("stop-color","#000").attr("stop-opacity",1),b.append("rect").attr("id","timelineView").attr("x",0).attr("y",10).attr("width",d).attr("height",c-10).style({fill:"url(#gradientGrayscale)",stroke:"white","stroke-width":"1px"}),b.append("g").classed({x:!0,axis:!0}).attr("id","tlxAxis").attr("transform","translate(0,"+c+")").call(g),b.append("g").classed({y:!0,axis:!0}).attr("id","tlyAxis").attr("transform","translate(0,10)").call(h),d3.select("#tlyAxis").selectAll(".tick").each(function(a){5===a&&d3.select(this).select("text").text(">5")});var s={className:"startTimeline",x:0,lastX:-1,time:new Date(y.invert(0))},t={className:"endTimeline",x:d,lastX:d+1,time:new Date(y.invert(d))},u=b.selectAll(".line").data([s,t]).enter().append("g").attr("transform",function(a){return"translate("+a.x+",0)"}).attr("class",function(a){return a.className});u.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",c),u.append("polygon").classed("timeMarker",!0).attr("points","0,50 5,60 -5,60"),u.append("polygon").classed("timeMarker",!0).attr("points","0,10 5,0 -5,0"),b.selectAll(".line").data(function(){return a.graph.aNodes}).enter().append("line").attr("id",function(a){return"tlAnalysisId-"+a.autoId}).classed("tlAnalysis",!0).attr("x1",function(a){return y(parseISOTimeFormat(a.start))}).attr("y1",function(a){return a.children.size()>=5?10:parseInt(c-(c-10)/5*a.children.size(),10)}).attr("x2",function(a){return y(parseISOTimeFormat(a.start))}).attr("y2",c),d3.selectAll(".startTimeline, .endTimeline").on("mouseover",function(){d3.select(this).classed("mouseoverTimeline",!0)}),o(d3.selectAll(".startTimeline, .endTimeline")),l(s)},ga=function(){var b=d3.select("#provenance-doi-view").select("svg").select("g").select("g").attr("transform",function(){return"translate(0,0)"}).select("g"),c=d3.values(provvisDecl.DoiFactors.factors),d=d3.scale.category10(),e=function(a){var c=0,e=30,f=(300-a.length*e)/2,g=b.selectAll("g").data(a),h=g.attr("id",function(a,b){return"doiCompId-"+b}).classed({doiComp:!0});h.select(".doiCompRect").classed("doiCompRect",!0).attr("x",0).attr("y",function(a){return c+=300*a.value,c-300*a.value}).attr("width",40).attr("height",function(a){return 300*a.value}),h.select(".doiCompHandle").classed("doiCompHandle",!0).attr("x",40+e).attr("y",function(a,b){return f+e*b}).attr("width",e).attr("height",e).style("fill",function(a,b){return d(10-b)}),c=0,h.select(".doiCompLine",!0).attr("x1",40).attr("y1",function(a){return c+=300*a.value,c-300*a.value/2}).attr("x2",40+e).attr("y2",function(a,b){return f+e*b+e/2}).style({stroke:function(a,b){return d(10-b)},"stroke-opacity":.7,"stroke-width":"2px"});var i=g.enter().append("g").attr("id",function(a,b){return"doiCompId-"+b}).classed({doiComp:!0});i.append("rect").classed("doiCompRect",!0).attr("x",0).attr("y",function(a){return c+=300*a.value,c-300*a.value}).attr("width",40).attr("height",function(a){return 300*a.value}).style("fill",function(a,b){return d(10-b)}),c=0,i.append("rect").classed("doiCompHandle",!0).attr("x",40+e).attr("y",function(a,b){return f+e*b}).attr("width",e).attr("height",e).style("fill",function(a,b){return d(10-b)}),c=0,i.append("line").classed("doiCompLine",!0).attr("x1",40).attr("y1",function(a){return c+=300*a.value,c-300*a.value/2}).attr("x2",40+e).attr("y2",function(a,b){return f+e*b+e/2}).style({stroke:function(a,b){return d(10-b)},"stroke-opacity":.7,"stroke-width":"2px"}),g.exit().remove(),$("#doiSpinners").css("padding-top",f)};e(c),c.forEach(function(a,b){$("<div/>",{id:"dc-form-"+b,"class":"form dc-form",style:"height: 30px; position: absolute; left: 75px; top: "+parseInt((10-c.length)/2*30+30*(b+1),10)+"px;"}).appendTo("#doiVis"),$("<input/>",{id:"dc-checkbox-"+b,"class":"dc-checkbox",type:"checkbox",checked:"true",style:"margin-top: 0px; margin-right: 2px; vertical-align: middle;"}).appendTo("#dc-form-"+b),$("<input/>",{id:"dc-input-"+b,type:"text","class":"form-control dc-input",value:a.value,style:"width: 25px; margin-bottom: 0px; margin-right: 2px; text-align: right;"}).appendTo("#dc-form-"+b),$("<div/>",{id:"btn-group-wrapper-"+b,"class":"btn-group"}).appendTo("#dc-form-"+b),$("<div/>",{id:"dc-btn-group-"+b,"class":"input-group-btn-vertical",style:"margin-right: 2px;"}).appendTo("#btn-group-wrapper-"+b),$("<button/>",{id:"dc-carret-up-"+b,"class":"btn btn-default",html:"<i class=icon-caret-up></i>"}).appendTo("#dc-btn-group-"+b),$("<button/>",{id:"dc-carret-down-"+b,"class":"btn btn-default",html:"<i class=icon-caret-down></i>"}).appendTo("#dc-btn-group-"+b),$("<span/>",{id:"dc-label-"+b,"class":"label dc-label",html:a.label,style:"margin-left: 2px; opacity: 0.7; background-color: "+d(10-b)+";"}).appendTo("#dc-form-"+b)}),$("<a/>",{id:"prov-doi-view-reset",href:"#",html:"Redistribute",style:"width: 25px; position: absolute; left: 90px; top: "+parseInt((10-c.length)/2*30+30*(c.length+1)+10,10)+"px;"}).appendTo("#doiVis");var f=function(){var a=d3.values(provvisDecl.DoiFactors.factors).filter(function(a){return provvisDecl.DoiFactors.isMasked(a.label)}).length;if(a>0){var b=d3.values(provvisDecl.DoiFactors.factors).filter(function(a,b){return provvisDecl.DoiFactors.isMasked(a.label)}).map(function(a){return a.value}).reduce(function(a,b){return a+b}),c=1;d3.values(provvisDecl.DoiFactors.factors).forEach(function(d,e){if(provvisDecl.DoiFactors.isMasked(d.label)){var f=$("#dc-checkbox-"+e)[0].checked;0===b?(provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[e],1/a,f),$("#dc-input-"+e).val(1/a)):(provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[e],d.value/b*c,f),$("#dc-input-"+e).val(d.value/b*c))}})}e(d3.values(provvisDecl.DoiFactors.factors))};d3.selectAll(".doiComp").on("click",function(){var a=d3.select(this).attr("id").substr(d3.select(this).attr("id").length-1,1),b=0;$("#dc-checkbox-"+a)[0].checked?($("#dc-checkbox-"+a).prop("checked",!1),$("#dc-label-"+a).css("opacity",.3),d3.select("#doiCompId-"+a).select(".doiCompHandle").classed("blendedDoiComp",!0),d3.select("#doiCompId-"+a).select(".doiCompLine").style("display","none"),$("#dc-input-"+a).val(b),provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[a],b,!1)):($($("#dc-checkbox-"+a)).prop("checked",!0),$("#dc-label-"+a).css("opacity",.7),d3.select("#doiCompId-"+a).select(".doiCompHandle").classed("blendedDoiComp",!1),d3.select("#doiCompId-"+a).select(".doiCompLine").style("display","inline"),provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[a],b,!0)),f()}),$(".dc-checkbox").click(function(){var a=$(this)[0].id[$(this)[0].id.length-1],b=0;$(this)[0].checked?($(this.parentNode).find(".dc-label").css("opacity",.7),d3.select("#doiCompId-"+a).select(".doiCompHandle").classed("blendedDoiComp",!1),d3.select("#doiCompId-"+a).select(".doiCompLine").style("display","inline"),b=0,provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[a],b,!0)):($(this.parentNode).find(".dc-label").css("opacity",.3),d3.select("#doiCompId-"+a).select(".doiCompHandle").classed("blendedDoiComp",!0),d3.select("#doiCompId-"+a).select(".doiCompLine").style("display","none"),b=0,$("#dc-input-"+a).val(b),provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[a],b,!1)),f()}),$(".dc-form .btn:first-of-type").on("click",function(){var a=$(this)[0].id[$(this)[0].id.length-1],b=parseFloat($("#dc-input-"+a).val())+.01;if($("#dc-checkbox-"+a)[0].checked&&1>=b){$("#dc-input-"+a).val(b),provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[a],b,!0);var c=d3.values(provvisDecl.DoiFactors.factors).filter(function(b,c){return c!=a&&provvisDecl.DoiFactors.isMasked(b.label)}).map(function(a){return a.value}).reduce(function(a,b){return a+b}),d=parseFloat(1-b);d3.values(provvisDecl.DoiFactors.factors).forEach(function(b,e){if(e!=a&&provvisDecl.DoiFactors.isMasked(b.label)){var f=$("#dc-checkbox-"+e)[0].checked;provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[e],b.value/c*d,f),$("#dc-input-"+e).val(b.value/c*d)}}),e(d3.values(provvisDecl.DoiFactors.factors))}}),$(".dc-form .btn:last-of-type").on("click",function(){var a=$(this)[0].id[$(this)[0].id.length-1],b=parseFloat($("#dc-input-"+a).val())-.01;if($("#dc-checkbox-"+a)[0].checked&&b>=0){$("#dc-input-"+a).val(b),provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[a],b,!0);var c=d3.values(provvisDecl.DoiFactors.factors).filter(function(b,c){return c!=a&&provvisDecl.DoiFactors.isMasked(b.label)}).map(function(a){return a.value}).reduce(function(a,b){return a+b}),d=parseFloat(1-b);d3.values(provvisDecl.DoiFactors.factors).forEach(function(b,e){if(e!=a&&provvisDecl.DoiFactors.isMasked(b.label)){var f=$("#dc-checkbox-"+e)[0].checked;provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[e],b.value/c*d,f),$("#dc-input-"+e).val(b.value/c*d)}}),e(d3.values(provvisDecl.DoiFactors.factors))}}),$(".dc-input").keypress(function(a){if(13==a.which){var b=$(this)[0].id[$(this)[0].id.length-1],c=parseFloat($("#dc-input-"+b).val());c>1?c=1:0>c&&(c=0),$(this).val(c),$($("#dc-checkbox-"+b)).prop("checked",!0),$("#doiCompId-"+b).find(".dc-label").css("opacity",.7),d3.select("#doiCompId-"+b).select(".doiCompHandle").classed("blendedDoiComp",!1),d3.select("#doiCompId-"+b).select(".doiCompLine").style("display","inline"),provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[b],c,!0);var d=d3.values(provvisDecl.DoiFactors.factors).filter(function(a,c){return c!=b&&provvisDecl.DoiFactors.isMasked(a.label)}).map(function(a){return a.value}).reduce(function(a,b){return a+b}),f=parseFloat(1-c);d3.values(provvisDecl.DoiFactors.factors).forEach(function(a,c){if(c!=b&&provvisDecl.DoiFactors.isMasked(a.label)){var e=$("#dc-checkbox-"+c)[0].checked;provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[c],a.value/d*f,e),$("#dc-input-"+c).val(a.value/d*f)}}),e(d3.values(provvisDecl.DoiFactors.factors))}}),$("#prov-doi-view-apply").on("click",function(){a.graph.lNodes.values().forEach(function(a){a.doi.computeWeightedSum(),a.children.values().forEach(function(a){a.doi.computeWeightedSum(),a.children.values().forEach(function(a){a.doi.computeWeightedSum(),a.children.values().forEach(function(a){a.doi.computeWeightedSum()})})})}),R()}),$("#prov-doi-view-reset").on("click",function(){var a=parseFloat(1/d3.values(provvisDecl.DoiFactors.factors).filter(function(a,b){return provvisDecl.DoiFactors.isMasked(a.label)}).length);d3.values(provvisDecl.DoiFactors.factors).forEach(function(b,c){provvisDecl.DoiFactors.isMasked(b.label)?($("#dc-input-"+c).val(a),provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[c],a,!0)):($("#dc-input-"+c).val(0),provvisDecl.DoiFactors.set(d3.keys(provvisDecl.DoiFactors.factors)[c],0,!1))}),e(d3.values(provvisDecl.DoiFactors.factors))}),$("#prov-doi-view-show").click(function(){$(this).find("input[type='checkbox']").prop("checked")?d3.selectAll(".nodeDoiLabel").style("display","inline"):d3.selectAll(".nodeDoiLabel").style("display","none")})},ha=function(){n.classed("hiddenLink",!0),h.each(function(a){a.highlighted=!1}),g.each(function(a){a.highlighted=!1,a.doi.highlightedChanged()})},ia=function(a){a.highlighted=!0,a.doi.highlightedChanged();for(var b=a.parent;b instanceof provvisDecl.BaseNode==!0;)b.highlighted=!0,b.doi.highlightedChanged(),b=b.parent;a instanceof provvisDecl.Layer?a.children.values().forEach(function(a){a.predLinks.values().forEach(function(a){a.highlighted=!0,a.hidden=!1,d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1),ia(a.source)})}):a.predLinks.values().forEach(function(a){a.highlighted=!0,a.hidden||d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1),ia(a.source)})},ja=function(a){a.highlighted=!0,a.doi.highlightedChanged();for(var b=a.parent;b instanceof provvisDecl.BaseNode==!0;)b.highlighted=!0,b.doi.highlightedChanged(),b=b.parent;a instanceof provvisDecl.Layer?a.children.values().forEach(function(a){a.succLinks.values().forEach(function(a){a.highlighted=!0,a.hidden=!1,d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1),ja(a.target)})}):a.succLinks.values().forEach(function(a){a.highlighted=!0,a.hidden||d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1),ja(a.target)})},ka=function(b){var c=a.canvas.select("g.aHLinks").selectAll(".hLink").data(b.aLinks);c.enter().append("path").classed({hLink:!0}).classed("blendedLink",function(){return"blend"===w?!0:!1}).classed("filteredLink",function(a){return a.filtered}).classed("hiddenLink",function(a){return!a.highlighted}).attr("id",function(a){return"hLinkId-"+a.autoId}),c.attr("d",function(a){var b=V(a.source),c=V(a.target);return"bezier1"===L?X(a,b.x,b.y,c.x,c.y):Y(a,b.x,b.y,c.x,c.y)}).classed("blendedLink",function(a){return a.filtered||"blend"!==w?!1:!0}).classed("filteredLink",function(a){return a.filtered}).classed("hiddenLink",function(a){return!a.highlighted}).attr("id",function(a){return"hLinkId-"+a.autoId}),c.exit().remove(),n=d3.selectAll(".hLink");var d=a.canvas.select("g.aLinks").selectAll(".link").data(b.aLinks);d.enter().append("path").classed({link:!0,aLink:!0}).classed("blendedLink",function(a){return a.filtered||"blend"!==w?!1:!0}).classed("filteredLink",function(a){return a.filtered}).classed("hiddenLink",function(a){return a.hidden}).attr("id",function(a){return"linkId-"+a.autoId}),d.attr("d",function(a){var b=V(a.source),c=V(a.target);return"bezier1"===L?X(a,b.x,b.y,c.x,c.y):Y(a,b.x,b.y,c.x,c.y)}).classed("blendedLink",function(a){return a.filtered||"blend"!==w?!1:!0}).classed("filteredLink",function(a){return a.filtered}).classed("hiddenLink",function(a){return a.hidden}).attr("id",function(a){return"linkId-"+a.autoId}),d.exit().remove(),i=d3.selectAll(".aLink"),h=d3.selectAll(".link")},la=function(a,b){var c=d3.min(a,function(a){return parseISOTimeFormat(a.start)}),d=d3.max(a,function(a){return parseISOTimeFormat(a.start)});return d3.time.scale().domain([c,d]).range([b[0],b[1]])},ma=function(d){var e=a.canvas.select("g.layers").selectAll(".layer").data(d.values()),f=e.enter().append("g").classed({layer:!0});f.attr("id",function(a){return"gNodeId-"+a.autoId}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"});var g=f.append("defs").append("linearGradient").attr("id",function(a){return"layerGradientId-"+a.autoId}).attr("x1","0%").attr("y1","100%").attr("x2","0%").attr("y2","0%");g.append("stop").attr("offset","0%").attr("stop-color",function(a){var b=d3.min(a.children.values(),function(a){return a.start});return v(parseISOTimeFormat(b))}).attr("stop-opacity",1),g.append("stop").attr("offset","100%").attr("stop-color",function(a){var b=d3.max(a.children.values(),function(a){return a.start});return v(parseISOTimeFormat(b))}).attr("stop-opacity",1),r=f.append("g").attr("id",function(a){return"BBoxId-"+a.autoId}).classed({lBBox:!0,BBox:!0,hiddenBBox:!1}).attr("transform",function(){return"translate("+-b.width/2+","+-b.height/2+")"}),r.append("rect").attr("y",-.6*J*a.radius).attr("width",function(){return b.width}).attr("height",function(){return b.height}).attr("rx",b.width/7).attr("ry",b.height/7),r.append("defs").append("clipPath").attr("id",function(a){return"lBBClipId-"+a.autoId}).append("rect").attr("y",-.6*J*a.radius).attr("width",b.width).attr("height",b.height+2*J*a.radius).attr("rx",b.width/7).attr("ry",b.height/7),r.append("g").classed({labels:!0}).attr("clip-path",function(a){return"url(#lBBClipId-"+a.autoId+")"}).append("text").attr("transform",function(){return"translate("+1*J*a.radius+","+.5*J*a.radius+")"}).text(function(a){return" "+a.wfCode}).classed("lBBoxLabel",!0).style({"font-family":"FontAwesome"});var h=r.append("g").classed("lDiff",!0).attr("transform",function(){return"translate(0,0)"});h.each(function(a){a.children.values().some(function(a){return 0!==a.motifDiff.numIns||0!==a.motifDiff.numOuts||0!==a.motifDiff.numSubanalyses})&&d3.select(this).append("text").text(function(){return""}).classed("diff-node-type-icon",!0).style({"font-family":"FontAwesome"})});var i=f.append("g").attr("id",function(a){return"nodeId-"+a.autoId}).classed({lNode:!0,filteredNode:!0,blendedNode:!1,selectedNode:!1}).classed({hiddenNode:function(a){return a.hidden}});f.append("g").classed({children:!0});var j=i.append("g").classed({glyph:!0}),k=i.append("g").classed({labels:!0});j.append("defs").append("clipPath").attr("id",function(a){return"bbClipId-"+a.autoId}).append("rect").attr("x",-2*J*a.radius).attr("y",-2*J*a.radius).attr("rx",1).attr("ry",1).attr("width",4*J*a.radius).attr("height",4*J*a.radius),j.each(function(b){getLayerPredCount(b)>0&&d3.select(this).append("g").classed({glAnchor:!0}).append("path").attr("d",function(){return"m"+-2*J*a.radius+" "+-.5*J*a.radius+" h"+-.8*J*a.radius+" a"+-.5*J*a.radius+" "+.5*J*a.radius+" 0 0 0 0 "+1*J*a.radius+" h"+.8*J*a.radius+" z"}).classed({llAnchor:!0})}),j.each(function(b){getLayerSuccCount(b)>0&&d3.select(this).append("g").classed({grAnchor:!0}).append("path").attr("d",function(){return"m"+2*J*a.radius+" "+-.5*J*a.radius+" h"+.8*J*a.radius+" a"+.5*J*a.radius+" "+.5*J*a.radius+" 0 0 1 0 "+1*J*a.radius+" h"+-.8*J*a.radius+" z"}).classed({rlAnchor:!0})}),j.each(function(b){getLayerPredCount(b)>1&&d3.select(this).select("g.glAnchor").append("text").attr("transform",function(){return"translate("+-2.8*J*a.radius+",0.5)"}).text(function(){return getLayerPredCount(b)}).attr("class","lLabel")}),j.each(function(b){getLayerSuccCount(b)>1&&d3.select(this).select("g.grAnchor").append("text").attr("transform",function(){return"translate("+2.8*J*a.radius+",0.5)"}).text(function(){return getLayerSuccCount(b)}).attr("class","lLabel")}),j.append("rect").attr("x",-2.25*J*a.radius).attr("y",-1*J*a.radius).attr("rx",1).attr("ry",1).attr("width",4.5*J*a.radius).attr("height",2*J*a.radius).style({fill:function(a){return"url(#layerGradientId-"+a.autoId+")"}}).classed({lGlyph:!0}),k.append("text").text(function(a){return a.doi.doiWeightedSum}).attr("class","nodeDoiLabel").style("display","none"),k.append("g").classed({wfLabel:!0}).attr("clip-path",function(a){return"url(#bbClipId-"+a.autoId+")"}),k.append("text").attr("transform",function(){return"translate("+-1.1*J*a.radius+","+0*J*a.radius+")"}).text(function(){return""}).classed("l-node-type-icon",!0).style({fill:function(a){var b=d3.min(a.children.values(),function(a){return a.start});return v(parseISOTimeFormat(b))<"#888888"?"#ffffff":"#000000"}}),k.append("text").attr("transform",function(){return"translate("+.8*J*a.radius+","+0*J*a.radius+")"}).text(function(a){return a.children.size()}).attr("class","lnLabel").style({fill:function(a){var b=d3.min(a.children.values(),function(a){return a.start});return v(parseISOTimeFormat(b))<"#888888"?"#ffffff":"#000000"}});e.attr("id",function(a){return"gNodeId-"+a.autoId}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"});e.exit().remove(),m=a.canvas.select("g.layers").selectAll(".layer"),c=d3.selectAll(".lNode"),r=d3.selectAll(".lBBox")},na=function(b){var c=a.canvas.select("g.lLinks").selectAll(".link").data(b.values());c.enter().append("path").classed({link:!0,lLink:!0}).attr("id",function(a){return"linkId-"+a.autoId}).classed("blendedLink",function(a){return a.filtered||"blend"!==w?!1:!0}).classed("filteredLink",function(a){return a.filtered}).classed("hiddenLink",function(a){return a.hidden}).attr("id",function(a){return"linkId-"+a.autoId}),c.attr("d",function(a){var b=V(a.source),c=V(a.target);return"bezier1"===L?X(a,b.x,b.y,c.x,c.y):Y(a,b.x,b.y,c.x,c.y)}).classed({link:!0,lLink:!0}).attr("id",function(a){return"linkId-"+a.autoId}).classed("blendedLink",function(a){return a.filtered||"blend"!==w?!1:!0}).classed("filteredLink",function(a){return a.filtered}).classed("hiddenLink",function(a){return a.hidden}).attr("id",function(a){return"linkId-"+a.autoId}),c.exit().remove(),o=a.canvas.select("g.lLinks").selectAll(".link")},oa=function(){var c=d3.select("g.analyses").selectAll(".analysis").data(a.graph.aNodes.sort(function(a,b){return parseISOTimeFormat(a.start)-parseISOTimeFormat(b.start)})),e=c.attr("id",function(a){return"gNodeId-"+a.autoId});e.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).style("fill",function(a){return v(parseISOTimeFormat(a.start))}),e.select("defs").select("clipPath").attr("id",function(a){return"bbClipId-"+a.autoId}).select("rect").attr("transform",function(){return"translate("+-b.width/2+","+-b.height/2+")"}).attr("y",-J*a.radius).attr("width",b.width).attr("height",b.height).attr("rx",b.width/7).attr("ry",b.height/7);var f=e.select("g").attr("id",function(a){return"BBoxId-"+a.autoId}).classed({aBBox:!0,BBox:!0,hiddenBBox:!0}).attr("transform",function(){return"translate("+-b.width/2+","+-b.height/2+")"});f.select("rect").attr("y",-.6*J*a.radius).attr("width",function(){return b.width}).attr("height",function(){return b.height}).attr("rx",b.width/7).attr("ry",b.height/7),f.select("defs").select("clipPath").attr("id",function(a){return"aBBClipId-"+a.autoId}).select("rect").attr("y",-.6*J*a.radius).attr("width",b.width).attr("height",b.height).attr("rx",b.width/7).attr("ry",b.height/7),f.select("g").classed({labels:!0}).attr("clip-path",function(a){return"url(#aBBClipId-"+a.autoId+")"}).select("text").attr("transform",function(){return"translate("+1*J*a.radius+","+.5*J*a.radius+")"}).text(function(a){return" "+a.wfCode}).classed("aBBoxLabel",!0).style({"font-family":"FontAwesome"}),i=e.select("g").attr("id",function(a){return"nodeId-"+a.autoId}).classed({aNode:!0,filteredNode:!0,blendedNode:!1,selectedNode:!1}).classed({hiddenNode:function(a){return a.hidden;
}}),e.select("g").classed({children:!0}),j=i.select("g.glyph"),l=i.select("g.labels").attr("clip-path",function(a){return"url(#bbClipId-"+a.autoId+")"}),J=.75,j.each(function(b){b.predLinks.size()>0&&d3.select(this).select("g.glAnchor").select("path").attr("d",function(){return"m"+-2*J*a.radius+" "+-.5*J*a.radius+" h"+-.8*J*a.radius+" a"+-.5*J*a.radius+" "+.5*J*a.radius+" 0 0 0 0 "+1*J*a.radius+" h"+.8*J*a.radius+" z"})}),j.each(function(b){b.predLinks.size()>1&&j.select("g.grAnchor").select("text").attr("transform",function(){return"translate("+-2.8*J*a.radius+",0.5)"}).text(function(a){return a.predLinks.size()}).attr("class","aLabel").style("display","inline")}),j.each(function(b){b.succLinks.size()>0&&d3.select(this).select("path").attr("d",function(){return"m"+2*J*a.radius+" "+-.5*J*a.radius+" h"+.8*J*a.radius+" a"+.5*J*a.radius+" "+.5*J*a.radius+" 0 0 1 0 "+1*J*a.radius+" h"+-.8*J*a.radius+" z"})}),j.each(function(b){b.succLinks.size()>1&&d3.select(this).select("text").attr("transform",function(){return"translate("+2.8*J*a.radius+",0.5)"}).text(function(a){return a.succLinks.size()}).attr("class","aLabel").style("display","inline")}),j.select("rect").attr("x",-2*J*a.radius).attr("y",-1.5*J*a.radius).attr("rx",1).attr("ry",1).attr("width",4*J*a.radius).attr("height",3*J*a.radius),l.select("text").text(function(a){return a.doi.doiWeightedSum}).attr("class","nodeDoiLabel").style("display","none");var g=c.enter().append("g").classed("analysis",!0).attr("id",function(a){return"gNodeId-"+a.autoId});g.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).style("fill",function(a){return v(parseISOTimeFormat(a.start))}),g.append("defs").append("clipPath").attr("id",function(a){return"bbClipId-"+a.autoId}).append("rect").attr("transform",function(){return"translate("+-b.width/2+","+-b.height/2+")"}).attr("y",-J*a.radius).attr("width",b.width).attr("height",b.height+2*J*a.radius).attr("rx",b.width/7).attr("ry",b.height/7),f=g.append("g").attr("id",function(a){return"BBoxId-"+a.autoId}).classed({aBBox:!0,BBox:!0,hiddenBBox:!0}).attr("transform",function(){return"translate("+-b.width/2+","+-b.height/2+")"}),f.append("rect").attr("y",-.6*J*a.radius).attr("width",function(){return b.width}).attr("height",function(){return b.height}).attr("rx",b.width/7).attr("ry",b.height/7);var h=f.append("g").classed("aDiff",!0).attr("transform",function(){return"translate(0,0)"});h.each(function(a){(0!==a.motifDiff.numIns||0!==a.motifDiff.numOuts||0!==a.motifDiff.numSubanalyses)&&d3.select(this).append("text").text(function(){return""}).classed("diff-node-type-icon",!0).style({"font-family":"FontAwesome"})}),f.append("defs").append("clipPath").attr("id",function(a){return"aBBClipId-"+a.autoId}).append("rect").attr("y",-.6*J*a.radius).attr("width",b.width).attr("height",b.height).attr("rx",b.width/7).attr("ry",b.height/7),f.append("g").classed({labels:!0}).attr("clip-path",function(a){return"url(#aBBClipId-"+a.autoId+")"}).append("text").attr("transform",function(){return"translate("+1*J*a.radius+","+.5*J*a.radius+")"}).text(function(a){return" "+a.wfCode}).classed("aBBoxLabel",!0).style({"font-family":"FontAwesome"});var i=g.append("g").attr("id",function(a){return"nodeId-"+a.autoId}).classed({aNode:!0,filteredNode:!0,blendedNode:!1,selectedNode:!1}).classed({hiddenNode:function(a){return a.hidden}});g.append("g").classed({children:!0});var j=i.append("g").classed({glyph:!0}),l=i.append("g").classed({labels:!0}).attr("clip-path",function(a){return"url(#bbClipId-"+a.autoId+")"});j.each(function(b){b.predLinks.size()>0&&d3.select(this).append("g").classed({glAnchor:!0}).append("path").attr("d",function(){return"m"+-2*J*a.radius+" "+-.5*J*a.radius+" h"+-.8*J*a.radius+" a"+-.5*J*a.radius+" "+.5*J*a.radius+" 0 0 0 0 "+1*J*a.radius+" h"+.8*J*a.radius+" z"}).classed({laAnchor:!0})}),j.each(function(b){b.predLinks.size()>1&&d3.select(this).select("g.glAnchor").append("text").attr("transform",function(){return"translate("+-2.8*J*a.radius+",0.5)"}).text(function(a){return a.predLinks.size()}).attr("class","aLabel").style("display","inline")}),j.each(function(b){b.succLinks.size()>0&&d3.select(this).append("g").classed({grAnchor:!0}).append("path").attr("d",function(){return"m"+2*J*a.radius+" "+-.5*J*a.radius+" h"+.8*J*a.radius+" a"+.5*J*a.radius+" "+.5*J*a.radius+" 0 0 1 0 "+1*J*a.radius+" h"+-.8*J*a.radius+" z"}).classed({raAnchor:!0})}),j.each(function(b){b.succLinks.size()>1&&d3.select(this).select("g.grAnchor").append("text").attr("transform",function(){return"translate("+2.8*J*a.radius+",0.5)"}).text(function(a){return a.succLinks.size()}).attr("class","aLabel").style("display","inline")}),j.append("rect").attr("x",-2.25*J*a.radius).attr("y",-1*J*a.radius).attr("rx",1).attr("ry",1).attr("width",4.5*J*a.radius).attr("height",2*J*a.radius).classed({aGlyph:!0}),l.append("text").text(function(a){return a.doi.doiWeightedSum}).attr("class","nodeDoiLabel").style("display","none"),l.append("text").attr("transform",function(){return"translate("+-1.1*J*a.radius+",0)"}).text(function(){return""}).classed("an-node-type-icon",!0).style({fill:function(a){return v(parseISOTimeFormat(a.start))<"#888888"?"#ffffff":"#000000"}}),l.append("text").attr("transform",function(){return"translate("+1*J*a.radius+",0)"}).text(function(a){return a.children.size()}).attr("class","anLabel").style({fill:function(a){return v(parseISOTimeFormat(a.start))<"#888888"?"#ffffff":"#000000"}}),c.exit().remove(),k=a.canvas.select("g.analyses").selectAll(".analysis"),d=d3.selectAll(".aNode"),q=d3.selectAll(".aBBox")},pa=function(a){var b=d3.select("#gNodeId-"+a.autoId).select("g.saHLinks").selectAll(".hLink").data(a.links.values());b.attr("d",function(a){return"bezier1"===L?X(a,a.source.x,a.source.y,a.target.x,a.target.y):Y(a,a.source.x,a.source.y,a.target.x,a.target.y)}).classed({hLink:!0,hiddenLink:!0}).attr("id",function(a){return"hLinkId-"+a.autoId}),b.enter().append("path").attr("d",function(a){return"bezier1"===L?X(a,a.source.x,a.source.y,a.target.x,a.target.y):Y(a,a.source.x,a.source.y,a.target.x,a.target.y)}).classed({hLink:!0,hiddenLink:!0}).attr("id",function(a){return"hLinkId-"+a.autoId}),b.exit().remove();var c=d3.select("#gNodeId-"+a.autoId).select("g.saLinks").selectAll(".Link").data(a.links.values());c.attr("d",function(a){return"bezier1"===L?X(a,a.source.x,a.source.y,a.target.x,a.target.y):Y(a,a.source.x,a.source.y,a.target.x,a.target.y)}).classed({link:!0,saLink:!0,hiddenLink:!0}).attr("id",function(a){return"linkId-"+a.autoId}),c.enter().append("path").attr("d",function(a){return"bezier1"===L?X(a,a.source.x,a.source.y,a.target.x,a.target.y):Y(a,a.source.x,a.source.y,a.target.x,a.target.y)}).classed({link:!0,saLink:!0,hiddenLink:!0}).attr("id",function(a){return"linkId-"+a.autoId}),c.exit().remove()},qa=function(){k.each(function(c){l=d3.select(this).select(".children").selectAll(".subanalysis").data(function(){return c.children.values()});var d=l.enter().append("g").classed("subanalysis",!0).attr("id",function(a){return"gNodeId-"+a.autoId}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"});d.each(function(c){var d=d3.select(this);d3.select("#gNodeId-"+c.autoId).append("g").classed({saHLinks:!0}),d3.select("#gNodeId-"+c.autoId).append("g").classed({saLinks:!0}),pa(c);var e=sa(c,0);d.append("defs").append("clipPath").attr("id","bbClipId-"+c.autoId).append("rect").attr("transform",function(){return"translate("+-b.width/2+","+-b.height/2+")"}).attr("width",b.width).attr("height",b.height);var f=d.append("g").attr("id",function(){return"BBoxId-"+c.autoId}).classed({saBBox:!0,BBox:!0,hiddenBBox:!0}).attr("transform",function(){return"translate("+-b.width/2+","+-b.height/2+")"});f.append("defs").attr("x",J*a.radius).attr("y",-.5*J*a.radius).append("clipPath").attr("id","saBBClipId-"+c.autoId).append("rect").attr("width",e.x.max-e.x.min-J*a.radius).attr("height",b.height),f.append("rect").attr("x",J*a.radius).attr("y",J*a.radius).attr("width",function(){return e.x.max-e.x.min-2*J*a.radius}).attr("height",function(){return e.y.max-e.y.min-2*J*a.radius}).attr("rx",b.width/7).attr("ry",b.height/7);var g=d.append("g").attr("id",function(){return"nodeId-"+c.autoId}).classed({saNode:!0,filteredNode:!0,blendedNode:!1,selectedNode:!1}).classed({hiddenNode:function(a){return a.hidden}});d.append("g").classed({children:!0});var h=g.append("g").classed({glyph:!0}),i=g.append("g").classed({labels:!0}).attr("clip-path","url(#bbClipId-"+c.autoId+")");h.each(function(b){b.predLinks.size()>0&&d3.select(this).append("g").classed({glAnchor:!0}).append("path").attr("d",function(){return"m"+-2*J*a.radius+" "+-.5*J*a.radius+" h"+-.8*J*a.radius+" a"+-.5*J*a.radius+" "+.5*J*a.radius+" 0 0 0 0 "+1*J*a.radius+" h"+.8*J*a.radius+" z"}).classed({lsaAnchor:!0})}),h.each(function(b){b.predLinks.size()>1&&d3.select(this).select("g.glAnchor").append("text").attr("transform",function(){return"translate("+-2.8*J*a.radius+",0.5)"}).text(function(a){return a.predLinks.size()}).attr("class","saLabel").style("display","inline")}),h.each(function(b){b.succLinks.size()>0&&h.append("g").classed({grAnchor:!0}).append("path").attr("d",function(){return"m"+2*J*a.radius+" "+-.5*J*a.radius+" h"+.8*J*a.radius+" a"+.5*J*a.radius+" "+.5*J*a.radius+" 0 0 1 0 "+1*J*a.radius+" h"+-.8*J*a.radius+" z"}).classed({rsaAnchor:!0})}),h.each(function(b){b.succLinks.size()>1&&d3.select(this).select("g.grAnchor").append("text").attr("transform",function(){return"translate("+2.8*J*a.radius+",0.5)"}).text(function(a){return a.succLinks.size()}).attr("class","saLabel").style("display","inline")}),h.append("rect").attr("x",-2.25*J*a.radius).attr("y",-1*J*a.radius).attr("rx",1).attr("ry",1).attr("width",4.5*J*a.radius).attr("height",2*J*a.radius),i.append("text").text(function(a){return a.doi.doiWeightedSum}).attr("class","nodeDoiLabel").style("display","none"),i.append("text").attr("transform",function(){return"translate("+-1.1*J*a.radius+",0)"}).text(function(){return""}).classed("san-node-type-icon",!0).style({fill:function(a){return v(parseISOTimeFormat(a.parent.start))<"#888888"?"#ffffff":"#000000"}}),i.append("text").attr("transform",function(){return"translate("+1*J*a.radius+",0)"}).text(function(a){return"dataset"!==a.wfUuid?a.children.values().filter(function(a){return"dt"===a.nodeType}).length:a.children.size()}).attr("class","sanLabel").style({fill:function(a){return v(parseISOTimeFormat(a.parent.start))<"#888888"?"#ffffff":"#000000"}})})}),e=d3.selectAll(".saNode"),l=d3.selectAll(".subanalysis"),p=d3.selectAll(".saBBox"),j=d3.selectAll(".saLink"),h=d3.selectAll(".link"),n=d3.selectAll(".hLink")},ra=function(){l.each(function(c){f=d3.select(this).select(".children").selectAll(".node").data(function(){return c.children.values()}).enter().append("g").classed("node",!0).attr("id",function(a){return"gNodeId-"+a.autoId}).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),f.each(function(c){var d=d3.select(this);d.attr("class",function(a){return"node "+a.nodeType+"Node"}).attr("id",function(a){return"nodeId-"+a.autoId}).classed("blendedNode",function(a){return a.filtered||"blend"!==w?!1:!0}).classed("filteredNode",function(a){return a.filtered}).classed("hiddenNode",function(a){return a.hidden}),d.append("defs").append("clipPath").attr("id","bbClipId-"+c.autoId).append("rect").attr("transform",function(){return"translate("+1*-b.width/2+","+3*-b.height/4+")"}).attr("width",b.width).attr("height",b.height+1*J*a.radius);var e=d.append("g").classed({glyph:!0}),f=d.append("g").classed({labels:!0}).attr("clip-path","url(#bbClipId-"+c.autoId+")");e.each(function(b){b.predLinks.size()>0&&d3.select(this).append("g").classed({glAnchor:!0}).append("path").attr("d",function(){return"m0 "+-.5*J*a.radius+" h"+-1*J*a.radius+" a"+-.5*J*a.radius+" "+.5*J*a.radius+" 0 0 0 0 "+1*J*a.radius+" h"+1*J*a.radius+" z"}).classed({lnAnchor:!0})}),e.each(function(b){b.succLinks.size()>0&&e.append("g").classed({grAnchor:!0}).append("path").attr("d",function(){return"m0 "+-.5*J*a.radius+" h"+1*J*a.radius+" a"+.5*J*a.radius+" "+.5*J*a.radius+" 0 0 1 0 "+1*J*a.radius+" h"+-1*J*a.radius+" z"}).classed({rnAnchor:!0})}),"raw"===c.nodeType||"intermediate"===c.nodeType||"stored"===c.nodeType?e.append("circle").attr("r",function(b){return"intermediate"===b.nodeType?3*J*a.radius/4:5*J*a.radius/6}):"special"===c.nodeType?e.append("rect").attr("transform","translate("+-3*J*a.radius/4+","+-3*J*a.radius/4+")").attr("width",1.5*J*a.radius).attr("height",1.5*J*a.radius):"dt"===c.nodeType&&e.append("rect").attr("transform",function(){return"translate("+-1.25*J*a.radius/2+","+-1.25*J*a.radius/2+")rotate(45 "+1.25*J*a.radius/2+","+1.25*J*a.radius/2+")"}).attr("width",1.25*J*a.radius).attr("height",1.25*J*a.radius),f.append("text").text(function(a){return a.doi.doiWeightedSum}).attr("class","nodeDoiLabel").style("display","none"),f.filter(function(a){return"stored"===a.nodeType}).append("text").attr("transform",function(){return"translate("+-1.5*J*a.radius+","+-1.5*J*a.radius+")"}).text(function(a){return a.attributes.get("name")}).attr("class","nodeAttrLabel"),f.each(function(a){"stored"===a.nodeType&&d3.select(this).append("text").text(function(){return""}).classed("stored-node-type-icon",!0).style({fill:function(a){return v(parseISOTimeFormat(a.parent.parent.start))<"#888888"?"#ffffff":"#000000"}})})})}),f=d3.selectAll(".node")},sa=function(a,c){var d,e,f,g=0;return a.children.empty()||!a.hidden?(d=-b.width/2+c,f=b.width/2-c,e=-b.width/2+c,g=b.width/2-c):(d=d3.min(a.children.values(),function(a){return a.x-b.width/2+c}),f=d3.max(a.children.values(),function(a){return a.x+b.width/2-c}),e=d3.min(a.children.values(),function(a){return a.y-b.height/2+c}),g=d3.max(a.children.values(),function(a){return a.y+b.height/2-c})),{x:{min:d,max:f},y:{min:e,max:g}}},ta=function(a,c){c||(c=0);var d=a.hidden?d3.min(a.children.values(),function(b){return b.hidden?d3.min(b.children.values(),function(c){return c.hidden?a.x:a.x+b.x+c.x}):a.x+b.x}):a.x,e=a.hidden?d3.max(a.children.values(),function(b){return b.hidden?d3.max(b.children.values(),function(c){return c.hidden?a.x:a.x+b.x+c.x}):a.x+b.x}):a.x,f=a.hidden?d3.min(a.children.values(),function(b){return b.hidden?d3.min(b.children.values(),function(c){return c.hidden?a.y:a.y+b.y+c.y}):a.y+b.y}):a.y,g=a.hidden?d3.max(a.children.values(),function(b){return b.hidden?d3.max(b.children.values(),function(c){return c.hidden?a.y:a.y+b.y+c.y}):a.y+b.y}):a.y;return{x:{min:d+c,max:e+b.width-c},y:{min:f+c,max:g+b.height-c}}},ua=function(b){var c=new dagre.graphlib.Graph;c.setGraph({rankdir:"LR",nodesep:0,edgesep:0,ranksep:0,marginx:0,marginy:0}),c.setDefaultEdgeLabel(function(){return{}});var d=0,e=0;b.lNodes.values().forEach(function(b){d=a.cell.width,e=a.cell.height,c.setNode(b.autoId,{label:b.autoId,width:d,height:e})}),b.lLinks.values().forEach(function(a){c.setEdge(a.source.autoId,a.target.autoId,{minlen:1,weight:1,width:0,height:0,labelpos:"r",labeloffset:0})}),dagre.layout(c);var f=d3.entries(c._nodes);b.lNodes.values().forEach(function(b){d=a.cell.width,e=a.cell.height,b.x=f.filter(function(a){return a.key===b.autoId.toString()})[0].value.x-d/2,b.y=f.filter(function(a){return a.key===b.autoId.toString()})[0].value.y-e/2,ba(b,d3.select("#gNodeId-"+b.autoId))})},va=function(b){var c=new dagre.graphlib.Graph;c.setGraph({rankdir:"LR",nodesep:1*J*a.radius,edgesep:0,ranksep:4*J*a.radius,marginx:0,marginy:0}),c.setDefaultEdgeLabel(function(){return{}});var d={},e=0,f=0,g=0,h=0;b.lNodes.values().forEach(function(b){if(d3.select("#BBoxId-"+b.autoId).classed("hiddenBBox",!0),b.hidden)b.children.values().filter(function(a){return a.filtered||"blend"===w}).forEach(function(a){d=ta(a,0),e=d.x.max-d.x.min,f=d.y.max-d.y.min,c.setNode(a.autoId,{label:a.autoId,width:e,height:f})});else{b.filtered&&d3.select("#BBoxId-"+b.autoId).classed("hiddenBBox",!1),e=a.cell.width,f=a.cell.height,g=0,h=b.y+a.cell.height,b.children.values().filter(function(a){return a.filtered||"blend"===w}).sort(function(a,b){return a.y-b.y}).forEach(function(a){a.exaggerated&&a.filtered?(g++,a.x=a.parent.x,a.y=h,h+=ta(a,0).y.max-ta(a,0).y.min,ba(a,d3.select("#gNodeId-"+a.autoId)),d3.select("#BBoxId-"+b.autoId).classed("hiddenBBox",!1),d3.select("#BBoxId-"+a.autoId).classed("hiddenBBox",!1)):(a.x=a.parent.x,a.y=a.parent.y)});var i=b.children.values().filter(function(a){return a.filtered||"blend"===w}).length;d3.select("#nodeId-"+b.autoId).select("g.labels").select(".lnLabel").text(function(){return i-g+"/"+b.children.size()});var j=f,k=e;b.children.values().filter(function(a){return a.filtered||"blend"===w}).forEach(function(a){a.exaggerated&&(d=ta(a,0),d.x.max-d.x.min>k&&(k=d.x.max-d.x.min),j+=d.y.max-d.y.min)}),d3.select("#lBBClipId-"+b.autoId).select("rect").attr("width",k).attr("height",j),d3.select("#BBoxId-"+b.autoId).attr("transform","translate("+-k/2+","+-a.cell.height/2+")").select("rect").attr("width",k).attr("height",j),c.setNode(b.autoId,{label:b.autoId,width:k,height:j})}}),b.lLinks.values().forEach(function(a){a.hidden||c.setEdge(a.source.autoId,a.target.autoId,{minlen:1,weight:1,width:0,height:0,labelpos:"r",labeloffset:0})}),b.aLinks.forEach(function(a){if(!a.hidden){var b=a.source.parent.parent.parent.autoId,d=a.target.parent.parent.parent.autoId;a.source.parent.parent.parent.hidden&&(b=a.source.parent.parent.autoId),a.target.parent.parent.parent.hidden&&(d=a.target.parent.parent.autoId),c.setEdge(b,d,{minlen:1,weight:1,width:0,height:0,labelpos:"r",labeloffset:0})}}),dagre.layout(c),K=d3.map();var i=0,j=0;d3.map(c._nodes).values().forEach(function(c){if("undefined"!=typeof c){if(b.lNodes.has(c.label)&&(b.lNodes.get(c.label).filtered||"blend"===w)){var f=b.lNodes.get(c.label);j=a.cell.height,i=a.cell.width,f.children.values().filter(function(a){return a.filtered||"blend"===w}).forEach(function(a){a.exaggerated&&(d=ta(a,0),d.x.max-d.x.min>i&&(i=d.x.max-d.x.min),j+=d.y.max-d.y.min)}),f.x=c.x-a.cell.width/2,f.y=c.y-j/2,g=0,h=f.y+a.cell.height,f.children.values().filter(function(a){return a.filtered||"blend"===w}).sort(function(a,b){return a.y-b.y}).forEach(function(b){d=ta(b,0),e=d.x.max-d.x.min,b.x=f.x-e/2+a.cell.width/2,b.exaggerated?(b.y=h,h+=ta(b,0).y.max-ta(b,0).y.min):b.y=b.parent.y})}else{var k=b.aNodes.filter(function(a){return a.autoId===c.label&&(a.filtered||"blend"===w)})[0];k&&"undefined"!=typeof k&&(d=ta(k,0),i=d.x.max-d.x.min,j=d.y.max-d.y.min,k.x=c.x-i/2,k.y=c.y-j/2)}K.has(c.x)?K.get(c.x).nodes.push(c.label):(K.set(c.x,{nodes:[],width:0}),K.get(c.x).nodes.push(c.label)),i>K.get(c.x).width&&(K.get(c.x).width=i)}}),a.graph.lNodes.values().forEach(function(a){ba(a,d3.select("#gNodeId-"+a.autoId))}),K.values().forEach(function(a){a.nodes=a.nodes.sort(function(a,b){return a.y-b.y})})},wa=function(c,d,e){"undefined"==typeof e&&(e="user");var f=Object.create(null),g=Object.create(null),h=[];"e"!==d||"layer"!==c.nodeType&&"analysis"!==c.nodeType&&"subanalysis"!==c.nodeType?"c"===d&&"layer"!==c.nodeType&&("subanalysis"===c.nodeType?c.parent.children.values().forEach(function(a){d3.select("#BBoxId-"+a.autoId).classed({hiddenBBox:!0})}):"analysis"===c.nodeType?(c.parent.children.values().forEach(function(a){d3.select("#BBoxId-"+a.autoId).classed({hiddenBBox:!0}),a.exaggerated=!1}),d3.select("#nodeId-"+c.parent.autoId).select("g.labels").select(".lLabel").text(function(){return c.children.size()+"/"+c.children.size()}),d3.select("#BBoxId-"+c.parent.autoId).classed({hiddenBBox:!1}),c.parent.children.values().forEach(function(a){a.children.values().forEach(function(a){d3.select("#BBoxId-"+a.autoId).classed("hiddenBBox",!0)})})):c.hidden===!1&&(g=sa(c.parent,0),h=c.parent.parent.children.values().filter(function(a){return a!==c.parent&&a.y>c.parent.y}),h.forEach(function(a){a.y-=g.y.max-g.y.min-b.height,U(d3.select("#gNodeId-"+a.autoId),a,a.x,a.y)}),c.parent.parent.children.values().filter(function(a){return a!==c.parent}).some(function(a){return a.hidden})&&(f=ta(c.parent.parent,0),c.parent.x=(f.x.max-f.x.min)/2-a.cell.width/2,U(d3.select("#gNodeId-"+c.parent.autoId),c.parent,c.parent.x,c.parent.y)),c.parent.parent.children.values().filter(function(a){return a!==c.parent}).every(function(a){return!a.hidden})&&c.parent.parent.children.values().forEach(function(a){a.x=0,U(d3.select("#gNodeId-"+a.autoId),a,a.x,a.y)})),c.parent.hidden=!1,d3.select("#nodeId-"+c.parent.autoId).classed("hiddenNode",!1),hideChildNodes(c.parent),"subanalysis"===c.nodeType?d3.select("#BBoxId-"+c.autoId).classed("hiddenBBox",!0):"analysis"===c.nodeType?c.parent.filtered||d3.select("#BBoxId-"+c.parent.autoId).classed("hiddenBBox",!0):d3.select("#BBoxId-"+c.parent.autoId).classed("hiddenBBox",!0),c.parent.links.values().forEach(function(a){d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("hiddenLink",!0),a.hidden=!0}),c.parent.inputs.values().forEach(function(a){a.predLinks.values().forEach(function(a){d3.select("#linkId-"+a.autoId).classed("hiddenLink",!1),a.highlighted&&d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1),a.hidden=!1})}),c.parent.outputs.values().forEach(function(a){a.succLinks.values().forEach(function(a){d3.select("#linkId-"+a.autoId).classed("hiddenLink",!1),a.highlighted&&d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1),a.hidden=!1})}),"subanalysis"===c.nodeType?(d3.selectAll("#BBoxId-"+c.parent.autoId+", #aBBClipId-"+c.parent.autoId).selectAll("rect").attr("width",function(){return d3.select(this.parentElement).attr("id")==="BBoxId-"+c.parent.autoId?b.width:b.width}).attr("height",function(){return b.height}),Z(c.parent)):"analysis"===c.nodeType?(c.parent.predLinks.values().forEach(function(a){a.source.hidden||(a.hidden=!1)}),c.parent.succLinks.values().forEach(function(a){a.target.hidden||(a.hidden=!1)}),Z(c.parent),U(d3.select("#gNodeId-"+c.parent.autoId),c.parent,c.parent.x,c.parent.y)):(d3.select("#BBoxId-"+c.parent.autoId).classed("hiddenBBox",!0),Z(c.parent.parent),U(d3.select("#gNodeId-"+c.parent.parent.autoId),c.parent.parent,c.parent.parent.x,c.parent.parent.y),f=ta(c.parent.parent,0),d3.selectAll("#BBoxId-"+c.parent.parent.autoId+", #aBBClipId-"+c.parent.parent.autoId).selectAll("rect").attr("width",function(){return f.x.max-f.x.min}).attr("height",function(){return f.y.max-f.y.min}),c.parent.parent.children.values().some(function(a){return a.hidden})||(f=ta(c.parent.parent,0),d3.select("#BBoxId-"+c.parent.parent.autoId).select("rect").attr("width",function(){return f.x.max-f.x.min}).attr("height",function(){return f.y.max-f.y.min}),d3.select("#aBBClipId-"+c.parent.parent.autoId).select("rect").attr("width",b.width).attr("height",b.height+2*J*a.radius).attr("rx",b.width/7).attr("ry",b.height/7)),Z(c.parent.parent))):(d3.select("#nodeId-"+c.autoId).classed("hiddenNode",!0),c.hidden=!0,c.children.values().forEach(function(a){d3.select("#nodeId-"+a.autoId).classed("hiddenNode",!1),a.hidden=!1,hideChildNodes(a)}),"subanalysis"===c.nodeType?c.links.values().forEach(function(a){a.hidden=!1,d3.select("#linkId-"+a.autoId).classed("hiddenLink",!1),a.highlighted&&d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1)}):"analysis"===c.nodeType?c.children.values().forEach(function(a){a.links.values().forEach(function(a){a.hidden=!0,d3.select("#linkId-"+a.autoId).classed("hiddenLink",!0),a.highlighted&&d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!0)})}):(c.predLinks.values().forEach(function(a){a.hidden=!0,d3.select("#linkId-"+a.autoId).classed("hiddenLink",!0),a.highlighted&&d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!0)}),c.succLinks.values().forEach(function(a){a.hidden=!0,d3.select("#linkId-"+a.autoId).classed("hiddenLink",!0),a.highlighted&&d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!0)})),c.inputs.values().forEach(function(a){a.predLinks.values().forEach(function(a){d3.select("#linkId-"+a.autoId).classed("hiddenLink",!1),a.highlighted&&d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1),a.hidden=!1})}),c.outputs.values().forEach(function(a){a.succLinks.values().forEach(function(a){d3.select("#linkId-"+a.autoId).classed("hiddenLink",!1),a.highlighted&&d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1),a.hidden=!1})}),"subanalysis"===c.nodeType?(d3.select("#BBoxId-"+c.autoId).classed("hiddenBBox",!1),g=sa(c,0),c.x=0,Z(c.parent),U(d3.select("#gNodeId-"+c.autoId),c,c.x,c.y),h=c.parent.children.values().filter(function(a){return a!==c&&a.y>c.y}),h.forEach(function(a){a.y+=g.y.max-g.y.min-b.height,U(d3.select("#gNodeId-"+a.autoId),a,a.x,a.y)}),f=ta(c.parent,0),d3.selectAll("#BBoxId-"+c.parent.autoId+", #aBBClipId-"+c.parent.autoId).selectAll("rect").attr("width",function(){return f.x.max-f.x.min}).attr("height",function(){return f.y.max-f.y.min}),c.parent.children.values().filter(function(a){return!a.hidden}).forEach(function(b){b.x=(f.x.max-f.x.min)/2-a.cell.width/2,U(d3.select("#gNodeId-"+b.autoId),b,b.x,b.y)}),U(d3.select("#gNodeId-"+c.autoId),c,c.x,c.y)):"analysis"===c.nodeType?(f=ta(c,0),d3.select("#BBoxId-"+c.autoId).select("rect").attr("width",function(){return f.x.max-f.x.min}).attr("height",function(){return f.y.max-f.y.min}),Z(c),U(d3.select("#gNodeId-"+c.autoId),c,c.x,c.y)):(c.children.values().filter(function(a){return a.filtered}).forEach(function(a){d3.select("#BBoxId-"+a.autoId).classed({hiddenBBox:!1}),a.links.values().forEach(function(a){d3.selectAll("#linkId-"+a.autoId+",#hLinkId-"+a.autoId).classed("hiddenLink",!0)}),a.children.values().forEach(function(a){d3.select("#BBoxId-"+a.autoId).classed("hiddenBBox",!0)}),f=ta(a,0),d3.selectAll("#BBoxId-"+a.autoId+", #aBBClipId-"+a.autoId).select("rect").attr("width",function(){return b.width}).attr("height",function(){return b.height})}),Z(c),U(d3.select("#gNodeId-"+c.autoId),c,c.x,c.y))),"user"===e&&(va(a.graph),O&&ya(C))},xa=function(a,b){ha(),"s"===b?ja(a):"p"===b&&ia(a),d3.select(".aHLinks").selectAll(".hLink").each(function(a){a.highlighted&&(a.hidden=!1,d3.select(this).classed("hiddenLink",!1))})},ya=function(b){var c=[0,0],d=[0,0];a.graph.aNodes.forEach(function(a){var b=ta(a,0);b.x.min<c[0]&&(c[0]=b.x.min),b.x.max>d[0]&&(d[0]=b.x.max),b.y.min<c[1]&&(c[1]=b.y.min),b.y.max>d[1]&&(d[1]=b.y.max)});var e=$("#provenance-sidebar").width()-$("#solr-facet-view").width()-parseFloat($("#main-area").css("margin-left").replace("px","")),f=[d[0]-c[0],d[1]-c[1]],g=[a.width/f[0],a.height/f[1]],h=.9*d3.min(g.concat([3])),i=[(e>0?e:0)+2*a.margin.left*h,(a.height-f[1]*h)/2+2*a.margin.top];a.canvas.transition().duration(b).attr("transform","translate("+i+")scale("+h+")"),a.zoom.translate(i),a.zoom.scale(h),setTimeout(function(){1>h?d3.selectAll(".BBox").classed("hiddenNode",!0):d3.selectAll(".BBox").classed("hiddenNode",!1),1.75>h?(a.canvas.selectAll(".anLabel, .sanLabel, .lnLabel, .nodeAttrLabel, .stored-node-type-icon, .an-node-type-icon, .san-node-type-icon, .l-node-type-icon, .lBBoxLabel, .aBBoxLabel, .nodeDoiLabel").classed("hiddenLabel",!0),d3.selectAll(".glAnchor, .grAnchor").classed("hiddenNode",!0),d3.selectAll(".lDiff, .aDiff").classed("hiddenNode",!0)):(a.canvas.selectAll(".anLabel, .sanLabel, .lnLabel, .nodeAttrLabel, .stored-node-type-icon, .an-node-type-icon, .san-node-type-icon, .l-node-type-icon, .lBBoxLabel, .aBBoxLabel, .nodeDoiLabel").classed("hiddenLabel",!1),d3.selectAll(".glAnchor, .grAnchor").classed("hiddenNode",!1),d3.selectAll(".lDiff, .aDiff").classed("hiddenNode",!1)),2.5>h?d3.selectAll(".lDiffLabel, .aDiffLabel").classed("hiddenLabel",!0):d3.selectAll(".lDiffLabel, .aDiffLabel").classed("hiddenLabel",!1)},b),a.rect.attr("transform","translate("+-i[0]/h+","+-i[1]/h+") scale("+1/h+")"),a.canvas.selectAll(".lBBoxLabel").transition().duration(b).attr("transform","translate("+1*J*a.radius+","+.5*J*a.radius+") scale("+1/h+")"),a.canvas.selectAll(".aBBoxLabel").transition().duration(b).attr("transform","translate("+1*J*a.radius+","+.5*J*a.radius+") scale("+1/h+")"),a.canvas.selectAll(".nodeDoiLabel").transition().duration(b).attr("transform","translate(0,"+1.6*J*a.radius+") scale("+1/h+")"),a.canvas.selectAll(".nodeAttrLabel").transition().duration(b).attr("transform","translate("+-1.5*J*a.radius+","+-1.5*J*a.radius+") scale("+1/h+")")},za=function(){g.each(function(a){a.selected=!1,a.doi.selectedChanged(),d3.select("#nodeId-"+a.autoId).classed("selectedNode",!1),$("#nodeId-"+a.autoId).find(".glyph").find("rect, circle").css({stroke:M})}),$("#nodeInfoTitle").html("Select a node: - "),$("#nodeInfoTitleLink").html(""),$("#provenance-nodeInfo-content").html(""),A=d3.map(),$(".filteredNode").hover(function(){$(this).find("rect, circle").css({stroke:N})},function(){$(this).find("rect, circle").css({stroke:M})})},Aa=function(a){za(),a.selected=!0,propagateNodeSelection(a,!0),A.set(a.autoId,a),d3.select("#nodeId-"+a.autoId).classed("selectedNode",a.selected).select(".glyph").select("rect, circle").style({stroke:N}),$("#nodeId-"+a.autoId).hover(function(){$(this).find("rect, circle").css({stroke:N})},function(){$(this).find("rect, circle").css({stroke:N})}),a.doi.selectedChanged()},Ba=function(){var b=d3.scale.category10(),i=d3.map();i.set("dataset",0),d3.values(a.graph.workflowData).forEach(function(a,b){i.set(a.name,b+1)}),i.entries().forEach(function(a,c){var d=a.key,e=d.indexOf("(imported");d=d.substr(0,e)||"Dataset",$("<tr/>",{id:"provvis-cc-wf-tr-"+c}).appendTo("#prov-ctrl-cc-workflow-content"),$("<td/>",{id:"provvis-cc-wf-td-"+c}).appendTo("#provvis-cc-wf-tr-"+c),$("<label/>",{id:"provvis-cc-wf-label-"+c,"class":"provvis-cc-label",html:'<input id="provvis-cc-wf-color-'+c+'" type="text">'+d}).appendTo("#provvis-cc-wf-td-"+c),$("<em/>",{id:"provvis-cc-wf-hex-"+c,"class":"provvis-cc-hide-hex",html:b(a.value)}).appendTo("#provvis-cc-wf-label-"+c),$("#provvis-cc-wf-color-"+c).spectrum({color:b(a.value),showAlpha:!1,change:function(a){$("#provvis-cc-wf-hex-"+c).text(a.toHexString()),l("workflow")}})});var j=function(a){$("#provvis-cc-strokes-hex").text(a),h.style({stroke:a}),g.style({stroke:a}),$(".glAnchor, .grAnchor").css({stroke:a,fill:a})},k=function(a){$("#provvis-cc-highlight-hex").text(a),n.style({stroke:a}),$(".filteredNode").hover(function(){$(this).find("rect, circle").css({stroke:a})},function(){$(this).find("rect, circle").css({stroke:M})}),$(".glAnchor, .grAnchor").hover(function(){$(this).css({stroke:a,fill:a})},function(){$(this).css({stroke:M,fill:M})})};$("#provvis-cc-strokes").spectrum({color:"#136382",showAlpha:!0,change:function(a){M=a.toHexString(),j(M),k(N)}}),$("#provvis-cc-highlight").spectrum({color:"#ed7407",showAlpha:!0,change:function(a){N=a.toHexString(),k(N)}}),$("#provvis-cc-layer").spectrum({color:"#1f77b4",showAlpha:!0,change:function(a){$("#provvis-cc-layer-hex").text(a.toHexString()),l("nodetype")}}),$("#provvis-cc-analysis").spectrum({color:"#2ca02c",showAlpha:!0,change:function(a){$("#provvis-cc-analysis-hex").text(a.toHexString()),l("nodetype")}}),$("#provvis-cc-subanalysis").spectrum({color:"#d62728",showAlpha:!0,change:function(a){$("#provvis-cc-subanalysis-hex").text(a.toHexString()),l("nodetype")}}),$("#provvis-cc-special").spectrum({color:"#17becf",showAlpha:!0,change:function(a){$("#provvis-cc-special-hex").text(a.toHexString()),l("nodetype")}}),$("#provvis-cc-dt").spectrum({color:"#7f7f7f",showAlpha:!0,change:function(a){$("#provvis-cc-dt-hex").text(a.toHexString()),l("nodetype")}}),$("#provvis-cc-intermediate").spectrum({color:"#bcbd22",showAlpha:!0,change:function(a){$("#provvis-cc-intermediate-hex").text(a.toHexString()),l("nodetype")}}),$("#provvis-cc-stored").spectrum({color:"#8c564b",showAlpha:!0,change:function(a){$("#provvis-cc-stored-hex").text(a.toHexString()),l("nodetype")}}),$("[id^=prov-ctrl-cc-none-]").on("click",function(){l("none")}),$("[id^=prov-ctrl-cc-time-]").on("click",function(){l("time")}),$("[id^=prov-ctrl-cc-workflow-]").on("click",function(){l("workflow")}),$("[id^=prov-ctrl-cc-nodetype-]").on("click",function(){l("nodetype")});var l=function(a){switch(a){case"none":g.select(".glyph").selectAll("rect, circle").style({fill:"#ffffff"}),g.selectAll(".anLabel, .sanLabel, .anwfLabel, .sanwfLabel, .an-node-type-icon, .san-node-type-icon").style({
fill:"#000000"}),c.selectAll(".lnLabel, .wfLabel, .l-node-type-icon").style({fill:"#000000"});break;case"time":c.each(function(a){d3.select("#nodeId-"+a.autoId).select(".glyph").selectAll("rect").style("fill",function(b){return"url(#layerGradientId-"+a.autoId+")"})}),c.selectAll(".lnLabel, .wfLabel, .l-node-type-icon").style({fill:function(a){var b=d3.min(a.children.values(),function(a){return a.start});return v(parseISOTimeFormat(b))<"#888888"?"#ffffff":"#000000"}}),d.select(".glyph").selectAll("rect, circle").style("fill",function(a){return v(parseISOTimeFormat(a.start))}),d.selectAll(".anLabel, .anwfLabel, .an-node-type-icon").style({fill:function(a){return v(parseISOTimeFormat(a.start))<"#888888"?"#ffffff":"#000000"}}),e.select(".glyph").selectAll("rect, circle").style("fill",function(a){return v(parseISOTimeFormat(a.parent.start))}),e.selectAll(".sanLabel, .sanwfLabel, .san-node-type-icon").style({fill:function(a){return v(parseISOTimeFormat(a.parent.start))<"#888888"?"#ffffff":"#000000"}}),f.select(".glyph").selectAll("rect, circle").style("fill",function(a){return v(parseISOTimeFormat(a.parent.parent.start))}),f.selectAll(".stored-node-type-icon").style({fill:function(a){return v(parseISOTimeFormat(a.parent.parent.start))<"#888888"?"#ffffff":"#000000"}});break;case"workflow":var b=function(a){return $("#provvis-cc-wf-hex-"+a).text()};g.each(function(a){for(var c=a;!(c instanceof provvisDecl.Layer);)c=c.parent;d3.select("#nodeId-"+a.autoId).select(".glyph").selectAll("rect, circle").style({fill:b(i.get(c.wfName))})}),g.selectAll(".anLabel, .sanLabel, .anwfLabel, .sanwfLabel, .an-node-type-icon, .san-node-type-icon").style({fill:"#000000"}),c.selectAll(".lnLabel, .wfLabel, .l-node-type-icon").style({fill:"#000000"});break;case"nodetype":var h=function(a){return $("#provvis-cc-"+a+"-hex").text()};g.each(function(a){d3.select("#nodeId-"+a.autoId).select(".glyph").selectAll("rect, circle").style({fill:h(a.nodeType)})}),g.selectAll(".anLabel, .sanLabel, .anwfLabel, .sanwfLabel, .an-node-type-icon, .san-node-type-icon").style({fill:"#000000"}),c.selectAll(".lnLabel, .wfLabel, .l-node-type-icon").style({fill:"#000000"}),f.selectAll(".stored-node-type-icon").style({fill:"#ffffff"})}}},Ca=function(b){var c=" - ",d=" - ",e=Object.create(null),f=d3.map(),g=0,h=0,i=0,j=0,k=0,l=0;switch(b.nodeType){case"raw":case"special":case"intermediate":case"stored":e=a.graph.nodeData.get(b.uuid),"undefined"!=typeof e&&(c='<i class="icon-sitemap rotate-icon-90"></i>&nbsp;'+b.fileType,d=null!==e.file_url?'<a href="'+e.file_url+'><i class="icon-download"></i>&nbsp;'+e.name+"</a>":" - ");break;case"dt":e=a.graph.nodeData.get(b.uuid),"undefined"!=typeof e&&(c='<i class="icon-sitemap rotate-icon-90"></i>&nbsp;'+b.fileType,null!==e.file_url&&(d="<a href="+e.file_url+' target="_blank"><i class="icon-download"></i>&nbsp;'+e.name+"</a>"));break;case"subanalysis":e=a.graph.workflowData.get(b.parent.wfUuid),"undefined"!=typeof e?(c='<i class="icon-cog"></i>&nbsp; Subanalysis',d="<a href=/workflows/"+b.wfUuid+' target="_blank">'+b.parent.wfName+"</a>"):c='<i class="icon-cog"></i>&nbsp; Dataset',(0!==b.parent.motifDiff.numIns||0!==b.parent.motifDiff.numOuts||0!==b.parent.motifDiff.numSubanalyses)&&(b.parent.motifDiff.numIns<0?g+=b.parent.motifDiff.numIns:h+=b.parent.motifDiff.numIns,b.parent.motifDiff.numSubanalyses<0?i+=b.parent.motifDiff.numSubanalyses:j+=b.parent.motifDiff.numSubanalyses,b.parent.motifDiff.numOuts<0?k+=b.parent.motifDiff.numOuts:l+=b.parent.motifDiff.numOuts);break;case"analysis":e=a.graph.analysisData.get(b.uuid),"undefined"!=typeof e?(c='<i class="icon-cogs"></i>&nbsp; Analysis',d="<a href=/workflows/"+b.wfUuid+' target="_blank">'+b.wfName+"</a>"):c='<i class="icon-cogs"></i>&nbsp; Dataset',(0!==b.motifDiff.numIns||0!==b.motifDiff.numOuts||0!==b.motifDiff.numSubanalyses)&&(b.motifDiff.numIns<0?g+=b.motifDiff.numIns:h+=b.motifDiff.numIns,b.motifDiff.numSubanalyses<0?i+=b.motifDiff.numSubanalyses:j+=b.motifDiff.numSubanalyses,b.motifDiff.numOuts<0?k+=b.motifDiff.numOuts:l+=b.motifDiff.numOuts);break;case"layer":e={aggregation_count:b.children.size(),workflow:b.wfName,subanalysis_count:b.motif.numSubanalyses,wfUuid:b.motif.wfUuid},"undefined"!=typeof e&&(c='<i class="icon-reorder"></i>&nbsp; Layer',d="<a href=/workflows/"+e.wfUuid+' target="_blank">'+e.workflow+"</a>"),b.children.values().some(function(a){return 0!==a.motifDiff.numIns||0!==a.motifDiff.numOuts||0!==a.motifDiff.numSubanalyses})&&b.children.values().forEach(function(a){a.motifDiff.numIns<0?g+=a.motifDiff.numIns:h+=a.motifDiff.numIns,a.motifDiff.numSubanalyses<0?i+=a.motifDiff.numSubanalyses:j+=a.motifDiff.numSubanalyses,a.motifDiff.numOuts<0?k+=a.motifDiff.numOuts:l+=a.motifDiff.numOuts})}(0!==g||0!==h)&&f.set("Diff: Inputs",g+" "+h),(0!==i||0!==j)&&f.set("Diff: Subanalyses",i+" "+j),(0!==k||0!==l)&&f.set("Diff: Outputs",k+" "+l),$("#nodeInfoTitle").html(c),$("#nodeInfoTitleLink").html(d),$("#provenance-nodeInfo-content").html(""),f.entries().forEach(function(a){$("<div/>",{"class":"refinery-subheader",html:"<h4>"+a.key+"</h4>"}).appendTo("#provenance-nodeInfo-content"),$("<p/>",{"class":"provvisNodeInfoValue provvisNodeInfoDiff",html:"<i><b>"+a.value+"</b></i>"}).appendTo("#provenance-nodeInfo-content")}),d3.entries(e).forEach(function(a){$("<div/>",{"class":"refinery-subheader",html:"<h4>"+a.key+"</h4>"}).appendTo("#provenance-nodeInfo-content"),$("<p/>",{"class":"provvisNodeInfoValue",html:"<i>"+a.value+"</i>"}).appendTo("#provenance-nodeInfo-content")})},Da=function(b){for(var c="dataset",d=b;!(d instanceof provvisDecl.Analysis);)d=d.parent;return"undefined"!=typeof a.graph.workflowData.get(d.wfUuid)&&(c=a.graph.workflowData.get(d.wfUuid).name),c.toString()},Ea=function(){var a=function(a,b){return"<b>"+a+": </b>"+b};f.on("mouseover",function(b){var c=d3.select(this),d=a("Name",b.name)+"<br>"+a("Type",b.fileType)+"<br>"+a("File Url",b.fileUrl)+"<br>"+a("UUID",b.uuid)+"<br>";b.attributes.forEach(function(b,c){d+=a(b,c)+"<br>"}),S(d,event),d3.select("#BBoxId-"+b.parent.parent.autoId).classed("mouseoverBBox",!0),d3.select("#BBoxId-"+b.parent.autoId).classed("mouseoverBBox",!0),c.select(".labels").attr("clip-path","")}).on("mousemove",function(b){var c=a("Name",b.name)+"<br>"+a("Type",b.fileType)+"<br>"+a("File Url",b.fileUrl)+"<br>"+a("UUID",b.uuid)+"<br>";b.attributes.forEach(function(b,d){c+=a(b,d)+"<br>"}),d3.select("#BBoxId-"+b.parent.parent.autoId).classed("mouseoverBBox",!0),d3.select("#BBoxId-"+b.parent.autoId).classed("mouseoverBBox",!0),S(c,event)}).on("mouseout",function(a){var b=d3.select(this);T(),d3.select("#BBoxId-"+a.parent.parent.autoId).classed("mouseoverBBox",!1),d3.select("#BBoxId-"+a.parent.autoId).classed("mouseoverBBox",!1),b.select(".labels").attr("clip-path","url(#bbClipId-"+a.autoId+")")}),e.on("mouseover",function(a){var b=d3.select(this);d3.select("#BBoxId-"+a.parent.autoId).classed("mouseoverBBox",!0),d3.select("#BBoxId-"+a.autoId).classed("mouseoverBBox",!0),b.select(".labels").attr("clip-path","")}).on("mousemove",function(a){d3.select("#BBoxId-"+a.parent.parent.autoId).classed("mouseoverBBox",!0),d3.select("#BBoxId-"+a.parent.autoId).classed("mouseoverBBox",!0)}).on("mouseout",function(a){var b=d3.select(this);d3.select("#BBoxId-"+a.parent.parent.autoId).classed("mouseoverBBox",!1),d3.select("#BBoxId-"+a.parent.autoId).classed("mouseoverBBox",!1),b.select(".labels").attr("clip-path","url(#bbClipId-"+a.autoId+")")}),d.on("mouseover",function(){var a=d3.select(this);a.select(".labels").attr("clip-path","")}).on("mousemove",function(a){}).on("mouseout",function(a){var b=d3.select(this);b.select(".labels").attr("clip-path","url(#bbClipId-"+a.autoId+")")}),c.on("mouseover",function(){var a=d3.select(this);a.select(".labels").select(".wfLabel").attr("clip-path","")}).on("mousemove",function(a){}).on("mouseout",function(a){var b=d3.select(this);b.select(".labels").select(".wfLabel").attr("clip-path","url(#bbClipId-"+a.autoId+")")}),p.on("mouseover",function(a){var b=d3.select(this);b.classed("mouseoverBBox",!0),d3.select("#BBoxId-"+a.parent.autoId).classed("mouseoverBBox",!0),b.select(".labels").attr("clip-path","")}).on("mouseout",function(a){var b=d3.select(this);b.classed("mouseoverBBox",!1),d3.select("#BBoxId-"+a.parent.autoId).classed("mouseoverBBox",!1),b.select(".labels").attr("clip-path","url(#saBBClipId-"+a.autoId+")")}),q.on("mouseover",function(a){var b=d3.select(this);b.select(".labels").attr("clip-path",""),a.parent.children.values().forEach(function(a){d3.select("#BBoxId-"+a.autoId).classed("mouseoverBBox",!0)})}).on("mouseout",function(a){var b=d3.select(this);b.select(".labels").attr("clip-path","url(#aBBClipId-"+a.autoId+")"),a.parent.children.values().forEach(function(a){d3.select("#BBoxId-"+a.autoId).classed("mouseoverBBox",!1)}),a.children.values().forEach(function(a){d3.select("#BBoxId-"+a.autoId).classed("mouseoverBBox",!1)})}),r.on("mouseover",function(){var a=d3.select(this);a.select(".labels").attr("clip-path",""),a.classed("mouseoverBBox",!0)}).on("mouseout",function(a){var b=d3.select(this);b.select(".labels").attr("clip-path","url(#lBBClipId-"+a.autoId+")"),b.classed("mouseoverBBox",!1)}),d3.selectAll(".tlAnalysis").on("mouseover",function(b){S(a("Created",parseISOTimeFormat(b.start))+"<br>"+a("Workflow",Da(b))+"<br>",event),d3.select("#BBoxId-"+b.autoId).classed("mouseoverTlBBox",!0)}).on("mousemove",function(b){S(a("Created",parseISOTimeFormat(b.start))+"<br>"+a("Workflow",Da(b))+"<br>",event)}).on("mouseout",function(a){T(),d3.select("#BBoxId-"+a.autoId).classed("mouseoverTlBBox",!1)})},Fa=function(){c.each(function(a){a.hidden=!0}),c.classed("hiddenNode",!0),d.each(function(a){a.hidden=!0}),d.classed("hiddenNode",!0),e.each(function(a){a.hidden=!0}),e.classed("hiddenNode",!0),f.each(function(a){a.hidden=!1}),f.classed("hiddenNode",!1),p.each(function(a){a.filtered&&a.children.values().some(function(a){return!a.hidden})?d3.select(this).classed("hiddenBBox",!1):d3.select(this).classed("hiddenBBox",!0)}),q.each(function(a){a.filtered&&a.parent.hidden&&(d3.select(this).classed("hiddenBBox",!1),d3.select(this).select("text").classed("hiddenLabel",!1))}),d.each(function(a){if("dataset"===a.uuid){var b=0;a.children.values().sort(function(a,b){return a.y-b.y}).forEach(function(a,c){var d=sa(a,0);a.y=b,b+=d.y.max-d.y.min,a.x=0,U(d3.select("#gNodeId-"+a.autoId),a,a.x,a.y)})}else{var c=sa(a.children.values()[0],0);a.children.values().sort(function(a,b){return a.y-b.y}).forEach(function(a,b){a.y=b*(c.y.max-c.y.min),a.x=0,U(d3.select("#gNodeId-"+a.autoId),a,a.x,a.y)})}var d=ta(a,0);d3.selectAll("#BBoxId-"+a.autoId+", #aBBClipId-"+a.autoId).selectAll("rect").attr("width",function(){return d.x.max-d.x.min}).attr("height",function(){return d.y.max-d.y.min}),d3.select("#BBoxId-"+a.autoId).classed("hiddenBBox",!1),a.filtered||d3.select("#BBoxId-"+a.autoId).classed("hiddenBBox",!0)}),h.each(function(a){a.hidden=!1}),h.classed("hiddenLink",!1),h.each(function(a){a.filtered?(a.hidden=!1,a.highlighted&&d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1)):"hide"===w?(a.hidden=!0,d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!0)):(a.hidden=!1,a.highlighted&&d3.select("#hLinkId-"+a.autoId).classed("hiddenLink",!1))}),o.each(function(a){a.hidden=!0}),o.classed("hiddenLink",!0)},Ga=function(){c.each(function(a){a.hidden=!0}),c.classed("hiddenNode",!0),d.each(function(a){a.hidden=!0}),d.classed("hiddenNode",!0),e.each(function(a){a.hidden=!1}),e.classed("hiddenNode",!1),f.each(function(a){a.hidden=!0}),f.classed("hiddenNode",!0),p.classed("hiddenBBox",!0),d.each(function(b){b.children.values().sort(function(a,b){return a.y-b.y}).forEach(function(b,c){b.y=c*a.cell.height,b.x=0,U(d3.select("#gNodeId-"+b.autoId),b,b.x,b.y)});var c=ta(b,0);d3.selectAll("#BBoxId-"+b.autoId+", #aBBClipId-"+b.autoId).selectAll("rect").attr("width",a.cell.width).attr("height",function(){return c.y.max-c.y.min}),d3.select("#BBoxId-"+b.autoId).classed("hiddenBBox",!1),b.filtered||d3.select("#BBoxId-"+b.autoId).classed("hiddenBBox",!0)}),d.each(function(a){a.links.values().forEach(function(a){d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("hiddenLink",!0),a.hidden=!0}),a.inputs.values().forEach(function(a){a.predLinks.values().forEach(function(a){d3.select("#linkId-"+a.autoId).classed("hiddenLink",!1),a.hidden=!1})})}),o.each(function(a){a.hidden=!0}),o.classed("hiddenLink",!0)},Ha=function(){c.each(function(a){a.hidden=!0}),c.classed("hiddenNode",!0),d.each(function(b){b.hidden=!1,hideChildNodes(b),b.filtered&&d3.select("#BBoxId-"+b.autoId).classed("hiddenBBox",!1),d3.selectAll("#BBoxId-"+b.autoId+", #aBBClipId-"+b.autoId).select("rect").attr("width",a.cell.width).attr("height",a.cell.height),b.children.values().sort(function(a,b){return a.y-b.y}).forEach(function(b,c){b.y=c*a.cell.height,b.x=0,U(d3.select("#gNodeId-"+b.autoId),b,b.x,b.y)})}),d.classed("hiddenNode",!1),p.classed("hiddenBBox",!0),d.each(function(a){a.links.values().forEach(function(a){d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("hiddenLink",!0),a.hidden=!0}),a.inputs.values().forEach(function(a){a.predLinks.values().forEach(function(a){d3.select("#linkId-"+a.autoId).classed("hiddenLink",!1),a.hidden=!1})})}),o.each(function(a){a.hidden=!0}),o.classed("hiddenLink",!0)},Ia=function(){c.each(function(a){a.hidden=!1,hideChildNodes(a),a.children.values().forEach(function(a){a.exaggerated=!1}),a.filtered&&d3.select("BBoxId-"+a.autoId).classed("hiddenBBox",!1)}),c.classed("hiddenNode",!1),p.classed("hiddenBBox",!0),q.classed("hiddenBBox",!0),d.each(function(b){b.links.values().forEach(function(a){d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("hiddenLink",!0),a.hidden=!0}),b.children.values().sort(function(a,b){return a.y-b.y}).forEach(function(b,c){b.y=c*a.cell.height,b.x=0,U(d3.select("#gNodeId-"+b.autoId),b,b.x,b.y)})}),i.each(function(a){a.hidden=!0}),i.classed("hiddenLink",!0),o.each(function(a){a.hidden=!1}),o.classed("hiddenLink",!1),d3.select(".aHLinks").selectAll(".hLink").each(function(a){a.highlighted&&(a.hidden=!1,d3.select(this).classed("hiddenLink",!1))})},Ja=function(b){$("#prov-ctrl-layers-click").click(function(){Ia(),va(b),O&&ya(C)}),$("#prov-ctrl-analyses-click").click(function(){Ha(),va(b),O&&ya(C)}),$("#prov-ctrl-subanalyses-click").click(function(){Ga(),va(b),O&&ya(C)}),$("#prov-ctrl-workflows-click").click(function(){Fa(),va(b),O&&ya(C)}),$("#prov-ctrl-filter-action > button").click(function(){w=$(this).prop("value"),"timeline"===x?ea(d3.select(".startTimeline").data()[0].time,d3.select(".endTimeline").data()[0].time,a):Sa(a,z)}),$("[id^=prov-ctrl-visible-attribute-list-]").click(function(){$(this).find("input[type='radio']").prop("checked",!0);var a=$(this).find("label").text();$("#prov-ctrl-visible-attribute-list > li").each(function(b,c){var d=$(c);d[0].id!=="prov-ctrl-visible-attribute-list-"+a&&d.find("input[type='radio']").prop("checked",!1)}),b.nodes.filter(function(a){return"stored"===a.nodeType}).forEach(function(b){d3.select("#nodeId-"+b.autoId).select(".nodeAttrLabel").text(b.attributes.get(a))})}),$("#prov-ctrl-toggle-sidebar").click(function(){$(this).hasClass("active")?($("#provenance-sidebar").animate({left:"-355"},C),$(this).html("OFF")):($("#provenance-sidebar").animate({left:"20"},C),$(this).html("ON"),$("#provvis-sidebar-content").css({height:"720px"}))}),$("#prov-ctrl-toggle-fit").click(function(){$(this).hasClass("active")?(O=!1,$(this).html("OFF")):(O=!0,$(this).html("ON"))})},Ka=function(a){Ja(a);var b;g.on("mousedown",function(a){d3.event.defaultPrevented||(clearTimeout(b),b=setTimeout(function(){B||(Aa(a),Ca(a))},200))}),g.on("dblclick",function(a){d3.event.defaultPrevented||(clearTimeout(b),wa(a,"e"))});var c;d3.selectAll(".brect, .link, .hLink, .vLine, .hLine",".cell").on("click",function(){d3.event.defaultPrevented||(clearTimeout(c),c=setTimeout(function(){ha(a.links),za()},200))}),d3.selectAll(".brect, .link, .hLink, .vLine, .hLine, .cell").on("dblclick",function(){d3.event.defaultPrevented||(clearTimeout(c),ya(1e3))}),Ea(),p.on("click",function(a){B||wa(a.children.values()[0],"c")});var d;q.on("click",function(a){d3.event.defaultPrevented||(clearTimeout(d),d=setTimeout(function(){B||(a.hidden?a.children.values().some(function(a){return a.hidden})?a.children.values().forEach(function(a){wa(a.children.values()[0],"c")}):wa(a.children.values()[0],"c"):wa(a,"c"))},200))}),q.on("dblclick",function(a){d3.event.defaultPrevented||(clearTimeout(d),B||(a.children.values().forEach(function(a){wa(a.children.values()[0],"c")}),wa(a.children.values()[0],"c"),wa(a,"c")))}),r.on("click",function(a){d3.event.defaultPrevented||B||(a.children.values().forEach(function(a){a.children.values().forEach(function(a){wa(a.children.values()[0],"c")}),wa(a.children.values()[0],"c")}),wa(a.children.values()[0],"c"))}),d3.selectAll(".glAnchor").on("click",function(a){xa(a,"p")}).on("mousedown",function(){d3.event.stopPropagation()}),d3.selectAll(".grAnchor").on("click",function(a){xa(a,"s")}).on("mousedown",function(){d3.event.stopPropagation()})},La=function(b){var c=d3.time.format.iso(new Date(0)),d=d3.time.format.iso(new Date(0));b.length>1&&(c=d3.min(b,function(a){return parseISOTimeFormat(a.start)}),d=d3.max(b,function(a){return parseISOTimeFormat(a.start)}));var e=d3.time.scale().domain([c,d]).range([0,1]);b.forEach(function(a){a.doi.initTimeComponent(e(parseISOTimeFormat(a.start))),a.children.values().forEach(function(b){b.doi.initTimeComponent(e(parseISOTimeFormat(a.start))),b.children.values().forEach(function(b){b.doi.initTimeComponent(e(parseISOTimeFormat(a.start)))})})}),a.graph.lNodes.values().forEach(function(a){a.doi.initTimeComponent(d3.mean(a.children.values(),function(a){return e(parseISOTimeFormat(a.start))}))})},Ma=function(a){a.values().forEach(function(a){a.filtered=!0,a.doi.filteredChanged(),a.children.values().forEach(function(a){a.filtered=!0,a.doi.filteredChanged(),a.children.values().forEach(function(a){a.filtered=!0,a.doi.filteredChanged(),a.children.values().forEach(function(a){a.filtered=!0,a.doi.filteredChanged()})})})})},Na=function(a,b){var c=0,d=d3.max(b,function(a){return d3.max([Math.abs(a.motifDiff.numIns),Math.abs(a.motifDiff.numSubanalyses),Math.abs(a.motifDiff.numOuts)],function(a){return a})});P=d3.scale.linear().domain([c,d]).range([0,1]),b.forEach(function(a){a.doi.initLayerDiffComponent(P(Math.abs(a.motifDiff.numIns)+Math.abs(a.motifDiff.numOuts)+Math.abs(a.motifDiff.numSubanalyses))),a.children.values().forEach(function(b){b.doi.initLayerDiffComponent(a.doi.doiLayerDiff),b.children.values().forEach(function(b){b.doi.initLayerDiffComponent(a.doi.doiLayerDiff)})})}),a.values().forEach(function(a){var b=d3.max(a.children.values(),function(a){return a.doi.doiLayerDiff});a.doi.initLayerDiffComponent(b)})},Oa=function(a){var b="";return a.forEach(function(a){b+="."+a+","}),d3.selectAll(b.substr(0,b.length-1))},Pa=function(c){a=c,b=c.cell,I=a.graph.lNodes,D=a.graph.aNodes,E=a.graph.saNodes,F=a.graph.nodes,H=a.graph.lLinks,G=a.graph.aLinks,s=a.graph.analysisWorkflowMap,t=a.graph.l.width,u=a.graph.l.depth,v=la(a.graph.aNodes,["white","black"]),La(a.graph.aNodes),Ma(a.graph.lNodes),w="blend",Na(a.graph.lNodes,a.graph.aNodes),a.canvas.append("g").classed({aHLinks:!0}),a.canvas.append("g").classed({aLinks:!0}),ka(a.graph),ua(a.graph),a.canvas.append("g").classed({lLinks:!0}),a.canvas.append("g").classed({layers:!0}),na(a.graph.lLinks),ma(a.graph.lNodes),a.canvas.append("g").classed({analyses:!0}),oa(),qa(),ra(),g=Oa(["lNode","aNode","saNode","node"]),da(m),da(k),a.graph.aNodes.forEach(function(a){wa(a,"c","auto")}),Qa(),Ra(),R(),fa(a),ga(),Ba(),Ka(a.graph),ya(0)},Qa=function(){m.each(function(a){var b=d3.select(this).select("#nodeId-"+a.autoId);a.filtered?(b.classed("filteredNode",!0).classed("blendedNode",!1),a.hidden||d3.select("#BBoxId-"+a.autoId).classed("hiddenBBox",!1)):(b.classed("filteredNode",!1).classed("blendedNode",function(){return"blend"===w?!0:!1}),d3.select("#BBoxId-"+a.autoId).classed("hiddenBBox",!0))}),k.each(function(a){var b=d3.select(this).select("#nodeId-"+a.autoId);a.filtered?(a.children.values().forEach(function(b){d3.select("#nodeId-"+b.autoId).classed("filteredNode",!0).classed("blendedNode",!1),b.children.values().forEach(function(a){d3.select("#nodeId-"+a.autoId).classed("filteredNode",!0).classed("blendedNode",!1)}),(a.children.values().some(function(a){return!a.hidden})||a.children.values().some(function(a){return a.children.values().some(function(a){return!a.hidden})}))&&d3.select("#BBoxId-"+a.autoId).classed("hiddenBBox",!1)}),a.hidden||d3.select("#BBoxId-"+a.autoId).classed("hiddenBBox",!1),b.classed("filteredNode",!0).classed("blendedNode",!1)):(b.classed("filteredNode",!1).classed("blendedNode",function(){return"blend"===w?!0:!1}),d3.select("#BBoxId-"+a.autoId).classed("hiddenBBox",!0),a.children.values().forEach(function(a){d3.select("#nodeId-"+a.autoId).classed("filteredNode",!1).classed("blendedNode",function(){return"blend"===w?!0:!1}),a.children.values().forEach(function(a){d3.select("#nodeId-"+a.autoId).classed("filteredNode",!1).classed("blendedNode",function(){return"blend"===w?!0:!1})})}))})},Ra=function(){j.classed("filteredLink",!1),e.each(function(a){a.filtered?a.links.values().forEach(function(a){d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed({filteredLink:!0,blendedLink:!1})}):a.links.values().forEach(function(a){d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("filteredLink",!1),"blend"===w?d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("blendedLink",!0):d3.selectAll("#linkId-"+a.autoId+", #hLinkId-"+a.autoId).classed("blendedLink",!1)})})},Sa=function(a,b){var c=[];if(x="facet",b instanceof SolrResponse){if(a.graph.lNodes=I,a.graph.aNodes=D,a.graph.saNodes=E,a.graph.nodes=F,a.graph.aLinks=G,a.graph.lLinks=H,b.getDocumentList().forEach(function(b){c.push(a.graph.nodeMap.get(b.uuid))}),a.graph.nodes.forEach(function(a){-1===c.map(function(a){return a.parent}).indexOf(a.parent)?(a.parent.children.values().forEach(function(a){a.filtered=!1}),a.parent.filtered=!1,a.parent.links.values().forEach(function(a){a.filtered=!1})):(a.parent.children.values().forEach(function(a){a.filtered=!0}),a.parent.filtered=!0,a.parent.links.values().forEach(function(a){a.filtered=!0})),a.parent.children.values().forEach(function(a){a.doi.filteredChanged()}),a.parent.doi.filteredChanged()}),a.graph.aNodes.forEach(function(a){a.children.values().some(function(a){return a.filtered})?a.filtered=!0:a.filtered=!1,a.doi.filteredChanged()}),a.graph.lNodes.values().forEach(function(a){a.children.values().some(function(a){return a.filtered})?a.filtered=!0:a.filtered=!1,a.doi.filteredChanged()}),a.graph.aLinks.forEach(function(a){a.filtered=!1}),a.graph.aLinks.filter(function(a){return a.source.parent.parent.filtered&&a.target.parent.parent.filtered}).forEach(function(a){a.filtered=!0}),a.graph.lLinks.values().forEach(function(a){a.filtered=!1}),a.graph.lLinks.values().filter(function(a){return a.source.filtered&&a.target.filtered}).forEach(function(a){a.filtered=!0}),"hide"===w){var d=d3.map();a.graph.lNodes.entries().forEach(function(a){a.value.filtered&&d.set(a.key,a.value)}),a.graph.lNodes=d,a.graph.aNodes=a.graph.aNodes.filter(function(a){return a.filtered}),a.graph.saNodes=a.graph.saNodes.filter(function(a){return a.filtered}),a.graph.nodes=a.graph.nodes.filter(function(a){return a.filtered}),a.graph.aLinks=a.graph.aLinks.filter(function(a){return a.filtered});var e=d3.map();a.graph.lLinks.entries().forEach(function(a){a.value.filtered&&e.set(a.key,a.value)}),a.graph.lLinks=e}va(a.graph),O&&ya(C),Qa(),Ra(),ka(a.graph),na(a.graph.lLinks),a.graph.aNodes.forEach(function(a){Z(a)}),a.graph.lNodes.values().forEach(function(a){Z(a)})}z=b};return{run:function(a){Pa(a)},update:function(a,b){Sa(a,b)}}}();
//# sourceMappingURL=provvis_render.js.map