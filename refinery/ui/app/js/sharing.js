/*! refinery-platform-ui 2015-06-16 */

angular.module("refinerySharing",[]).controller("refinerySharingController",["$scope","$http","$modal",function(a,b,c){function d(a){var b=document.getElementById(a);if(b){cells=b.getElementsByTagName("td");for(var c=0;c<cells.length;c+=3)cells[c+2].children[0].style.display="inline","icon-user"!==cells[c].children[0].className&&(cells[c+2].children[0].innerText="N/A")}}function e(a,c){b.get("api/v1/"+a+"/?uuid="+c+"&format=json").success(function(a){document.getElementById("modal-description").innerText=a.objects[0].owner+" | "+a.objects[0].res_name;for(var b=a.objects,c=document.getElementById("permission-table"),d=0;d<b.length;d++){var e=b[d].permissions.read,f=b[d].permissions.change;f&&(e=!0);var g=c.insertRow(-1),h=g.insertCell(0);h.innerHTML=b[d].group_name+'<div style="display: none;">'+b[d].group_id+"</div>";var i=g.insertCell(1),j=g.insertCell(2),k=g.insertCell(3),l=e||f?"":"checked",m=e&&!f?"checked":"",n=f?"checked":"",o='<td><input type="radio" name="'+d+'" '+l+"></td>",p='<td><input type="radio" name="'+d+'" '+m+"></td>",q='<td><input type="radio" name="'+d+'" '+n+"></td>";i.innerHTML=o,j.innerHTML=p,k.innerHTML=q}})}user_id&&$(document).ready(function(){d("dataset-table"),d("project-table")});var f=function(a,b,c,d){e(d.api,d.uuid),a.config=d,a.save=function(){for(var a=document.getElementById("permission-table"),e=a.getElementsByTagName("td"),f=0;f<e.length;f+=4){var g=(e[f].innerText,e[f].children[0].innerText),h=e[f+2].children[0].checked||e[f+3].children[0].checked,i=e[f+3].children[0].checked,j='{"read": '+h+', "change": '+i+"}";b({method:"PATCH",url:"api/v1/"+d.api+"/"+d.uuid+"_"+g+"/",data:j})}c.dismiss("saved")},a.cancel=function(){c.dismiss("cancel")}};f.$inject=["$scope","$http","$modalInstance","config"],a.openPermissionEditor=function(b,d){a.newPermissionModalConfig={title:"Permission Editor"};c.open({templateUrl:"static/partials/sharing.tpls.html",controller:f,resolve:{config:function(){return{api:b,uuid:d}}}})}}]);
//# sourceMappingURL=sharing.js.map