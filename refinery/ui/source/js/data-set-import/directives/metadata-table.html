<form
  name="importMetadataTableForm"
  enctype="multipart/form-data"
  action="{% url 'process_metadata_table' %}"
  method="post">

  <p>Please select a file containing a metadata table in tab-delimited format.</p>
  <input
    type="file"
    class="refinery-base"
    name="file"
    required
    ng-file-select="onFileSelect($files)"/>

<!--       {% if error_message %}
    <p><strong>{{ error_message }}</strong></p>
  {% endif %} -->

  <div ng-if="selectedFile">
    <div class="gridStyle" ui-grid="gridOptions" ui-grid-resize-columns></div>

    <p>
      Please provide the following values (fields marked in
      <strong>bold</strong> are required):
    </p>

    <table>
      <colgroup>
        <col style="width: 12%"/>
      </colgroup>

      <tr>
        <td><strong>Title</strong></td>
        <td>
          <input
            type="text"
            class="refinery-base"
            name="title"
            required
            ng-model="title"/>
        </td>
        <td>name of this data set</td>
      </tr>

      <tr>
        <td><strong>Source Column Index</strong></td>
        <td>
          {% verbatim %}
          <select
            class="select-height"
            name="source_column_index"
            required
            multiple
            size="{{ metadataHeader.length || 10 }}"
            ng-model="sourceColumnIndex"
            ng-options="id as heading for (id, heading) in metadataHeader">
          </select>
          {% endverbatim %}
        </td>
        <td>
          columns to be used for source grouping. Values in the columns
          indicated by the list of columns provided for the Source
          ColumnIndex will be concatenated to create an identifier for
          the "source" of the sample.
        </td>
      </tr>

      <tr>
        <td><strong>Data File Column</strong></td>
        <td>
          <select
            name="data_file_column"
            required
            ng-model="data.dataFileColumn"
            ng-options="heading for (id, heading) in metadataHeader track by id">
            <!-- needed to make required option to work properly -->
            <option></option>
          </select>
        </td>
        <td>
          column that contains the path to or the URL of the file
          associated with this sample
        </td>
      </tr>

      <tr>
        <td>Auxiliary File Column</td>
        <td>
            <select
              name="aux_file_column"
              ng-model="auxFileColumn"
              ng-options="heading for heading in metadataHeader">
            </select>
        </td>
        <td>
          Column that contains the path to an auxiliary file (e.g. for
          visualization) associated with the input file
        </td>
      </tr>

      <tr>
        <td>Species Column</td>
        <td>
          <select
            name="species_column"
            ng-model="speciesColumn"
            ng-options="heading for heading in metadataHeader">
          </select>
        </td>
        <td>column containing species names or IDs</td>
      </tr>

      <tr>
        <td>Base path</td>
        <td>
          <input
            type="text"
            class="refinery-base"
            name="base_path"
            ng-model="basePath">
        </td>
        <td>
          base path of your data file paths if using relative locations
        </td>
      </tr>

      <tr>
        <td>Annotation column</td>
        <td>
          <select
            name="annotation_column"
            ng-model="annotationColumn"
            ng-options="heading for heading in metadataHeader">
          </select>
        </td>
        <td>
          column containing boolean flag to indicate whether the data
          file in this row should be treated as an annotation file
        </td>
      </tr>

      <tr>
        <td>Genome build column</td>
        <td>
          <select
            name="genome_build_column"
            ng-model="genomeBuildColumn"
            ng-options="heading for heading in metadataHeader">
          </select>
        </td>
        <td>column containing genome build IDs</td>
      </tr>

      <tr>
        <td>Slug</td>
        <td>
          <input
            type="text"
            class="refinery-base"
            name="slug"
            ng-model="slug">
        </td>
        <td>
          shortcut name for dataset URL; can only contain alpha-numeric
          characters and _
        </td>
      </tr>
      <tr>

      <tr>
        <td>Data file permanent</td>
        <td>
          <input
            type="checkbox"
            name="data_file_permanent"
            ng-model="dataFilePermanent"/>
        </td>
        <td>
          flag for whether data files should be permanently on the system
          or cached
        </td>
      </tr>

      <tr>
        <td>Is public</td>
        <td>
          <input
            type="checkbox"
            name="is_public"
            ng-model="isPublic"/>
        </td>
        <td>
          flag for whether this data set will be visible to the public
        </td>
      </tr>
    </table>

    <input
      style="float: left;"
      class="refinery-base btn btn-default"
      type="button"
      value="Check Files"
      ng-click="checkFiles()"
      ng-disabled="!data.dataFileColumn"/>
    <input
      style="float: left;"
      class="refinery-base btn btn-default"
      id="tabular-import-button"
      type="submit"
      value="Import"
      ng-disabled="importMetadataTableForm.$invalid"/>
    <div
      style="margin-left: 15px; padding: 15px; float: left;
                display: block; height: 22px; width: 22px;"
      id="tabular-spinner">
    </div>
  </div>
</form>
